var initCanvas={};console.log("Enter initCanvas.js");
var cy=cytoscape({container:document.getElementById("cy"),layout:{name:"grid",rows:1},style:[{selector:"node",style:{content:"data(id)","text-opacity":1,"text-valign":"center","text-halign":"center","border-width":1,"border-color":"black","transition-property":"border-width, border-color","transition-duration":"0.8s"}},{selector:"edge",style:{width:4,"target-arrow-shape":"triangle","line-color":"#9dbaea","target-arrow-color":"#9dbaea","curve-style":"bezier"}},{selector:".page",style:{shape:"roundrectangle",
"background-color":"light-gray"}},{selector:".control",style:{shape:"ellipse","background-color":"#72dadb"}},{selector:".source_node",style:{"border-width":7,"border-color":"#9dbaea","transition-duration":"0.1s"}},{selector:".disconnected",style:{"border-width":7,"border-color":"red","transition-property":"border-width, border-color","transition-duration":"0.1s"}},{selector:".start",style:{content:"Start"}},{selector:".success-edge",style:{"line-color":"#a1d490","target-arrow-color":"#a1d490"}},{selector:".fail-edge",
style:{"line-color":"#c390d4","target-arrow-color":"#c390d4"}},{selector:":selected",style:{"border-width":5,"line-color":"black","target-arrow-color":"black","transition-duration":"0.1s"}}],boxSelectionEnabled:!0,selectionType:"single",minZoom:.2,maxZoom:5});cy.panzoom();resizeCanvas();console.log("Canvas done");var assetLoad={};function loadAudio(){var a=prompt("Enter audio url",cy.$(":selected").data("audio"));null!=a&&(cy.$(":selected").data("audio",a),$("#audio").attr("src",cy.$(":selected").data("audio")))}function toggleAudio(){0==$("#audio")[0].paused?$("#audio")[0].pause():$("#audio")[0].play()}function changeAudio(){$("#audio")[0].pause();"none"==cy.$(":selected").data("audio")?console.log("no audio link"):$("#audio").attr("src",cy.$(":selected").data("audio"))}
function loadImage(){console.log("Image: ",cy.$(":selected").data("id"));console.log(cy.$(":selected").data("img"));var a=prompt("Enter image url",cy.$(":selected").data("img"));null!=a&&(cy.$(":selected").data("img",a),$("#pageimg").attr("src",cy.$(":selected").data("img")),resizeImage(100,100))}function changeImage(){"none"==cy.$(":selected").data("img")?(resizeImage(0,0),console.log("no image link found")):($("#pageimg").attr("src",cy.$(":selected").data("img")),resizeImage(100,100))}
function resizeImage(a,b){$("#pageimg").attr("width",a);$("#pageimg").attr("height",b);resizeCanvas()};var httpRequests={};console.log("Enter httpRequests.js");function http_save(){console.log("save");$.ajax({type:"POST",url:"php/save.php",data:JSON.stringify(cy.elements().jsons()),success:function(a){alert("Graph Saved")},contentType:"application/json"})}function http_load(){console.log("Load");var a=cy.elements();cy.remove(a);$.get("php/load.php",function(a,d){var c=JSON.parse(a);cy.add(c)})}
function http_delete(a){console.log("Delete");$.ajax({type:"POST",url:"php/delete.php",data:JSON.stringify(a),success:function(a){},contentType:"application/json"})};var states={DEFAULT:0,CONNECTING:1,NEWPAGE:2,NEWCONTROL:3};current_state=states.DEFAULT;function exitStates(){current_state==states.CONNECTING&&(cy.boxSelectionEnabled(!0),null!==source_node&&(source_node.removeClass("source_node"),source_node=null))}
function changeState(a){exitStates();$("#sidebar .button").removeClass("activebutton");$(a).addClass("activebutton");$(a).hasClass("connectionmode")&&current_state!=states.CONNECTING?(current_state=states.CONNECTING,cy.boxSelectionEnabled(!1),source_node=null,cy.$(":selected").unselect()):$(a).hasClass("pagemode")&&current_state!=states.NEWPAGE?current_state=states.NEWPAGE:$(a).hasClass("controlmode")&&current_state!=states.NEWCONTROL?current_state=states.NEWCONTROL:($(a).hasClass("deletebutton")&&
removeElement(),current_state=states.DEFAULT,$(a).removeClass("activebutton"))};var ui={};
function updateEditPane(a){1===cy.$(":selected").size()&&(a.hasClass("control")?($("#editcontrol").show(),$("#controlname").text("control "+a.data("id")),document.getElementById("controltext").value=a.data("text")):a.hasClass("page")?($("#editpage").show(),$("#pagename").text("Page "+a.data("id")),document.getElementById("pagetext").value=a.data("text"),changeImage(),changeAudio()):a.isEdge()&&($("#editconnection").show(),$("#connectionname").text("Connection"),document.getElementById("connectiontext").value=a.data("text")))}
function hideEditPanes(){$("#editpage").hide();$("#editcontrol").hide();$("#editconnection").hide();0===cy.$(":selected").size()&&$(".selectionbutton").hide()}$(".textarea").on("input",function(a){a=this.value;cy.$(":selected").data("text",a)});
function removeElement(){element=cy.$(":selected");!element.empty()&&confirm("Are you sure you want to delete this element and all it's links?")&&(cy.remove(element),hideEditPanes(),cy.$("node").first().addClass("start"),http_delete(element.connectedEdges().jsons()),http_delete(element.jsons()),cy.remove(element),hideEditPanes());cy.$("node").first().addClass("start")}
function createConnection(a){if(current_state==states.CONNECTING&&a.isNode())if(null==source_node)source_node=a,source_node.addClass("source_node"),console.log("Source node assigned as node",a.data("id"));else if(source_node.data("id")!=a.data("id")){console.log("Creating link from ",source_node.data("id")," to ",a.data("id"));var b="",d=!0;if(source_node.hasClass("control")){var c=source_node.edgesTo("*");console.log("Size from control: ",c.size());0===c.size()?b="success-edge":1===c.size()?b=c.first().hasClass("success-edge")?
"fail-edge":"success-edge":d=!1}d&&cy.add({data:{source:source_node.data("id"),target:a.data("id"),text:"<Decision text to display)>"},classes:b,group:"edges"});source_node.removeClass("source_node");source_node=null;a.unselect()}}function resizeCanvas(){var a=$(window).width(),b=$(window).height(),d=$("#tabheadings").height();$("#cy").css("width",9*a/12-30);$("#cy").css("height",b-d);$("#sidebar").css("height",b-d);console.log("We resized, width: "+a+" height: "+b);cy.resize()}$(window).resize(resizeCanvas);
var observer=new MutationObserver(function(a){a.forEach(function(a){"tab-pane fade"==a.oldValue&&"tab-pane fade active in"==a.target.className&&cy.resize()})}),cytabNode=$("#cyTab")[0],observerConfig={attributes:!0,childList:!1,characterData:!1,attributeOldValue:!0,attributeFilter:["class"]};observer.observe(cytabNode,observerConfig);var canvasEvents={};console.log("Enter canvasEvents.js");total_pages=0;source_node=null;
cy.on("tap",function(a){var b=a.cyTarget;b===cy&&cy.$(":selected").unselect();current_state!==states.CONNECTING||b!==source_node&&b!==cy||null===source_node||(source_node.removeClass("source_node"),source_node=null);current_state===states.NEWPAGE?b===cy&&cy.add({data:{id:++total_pages,text:"page text",img:"none",audio:"none"},classes:"page",group:"nodes",renderedPosition:a.cyRenderedPosition}):current_state===states.NEWCONTROL&&b===cy&&cy.add({data:{id:++total_pages,text:"control node text"},classes:"control",
group:"nodes",renderedPosition:a.cyRenderedPosition})});cy.on("select",function(a){console.log("Select event fired ",a.cyTarget.data("id"));current_state===states.CONNECTING&&(cy.$(":selected").diff(a.cyTarget).left.unselect(),createConnection(a.cyTarget));hideEditPanes();updateEditPane(a.cyTarget);$(".selectionbutton").show()});
cy.on("unselect",function(a){console.log("Unselect event fired ",a.cyTarget.data("id"));1!==cy.$(":selected").size()?hideEditPanes():(console.log("Only one selected"),hideEditPanes(),updateEditPane(cy.$(":selected")))});var pageOverlay={};function showPageOverlay(){document.getElementById("Modal").showModal()}function closeOverlay(){document.getElementById("Modal").close()};console.log("Enter main.js version 0.5.0");var dialog=document.querySelector("dialog");dialogPolyfill.registerDialog(dialog);var testgraph={};function checkValidGraph(){var a="";cy.$(".start").hasClass("page")||(a=a.concat("Starting class must be a page node\n"));testConnectivity()||(a=a.concat("Graph is NOT connected\n"));""==a?alert("All tests passed"):alert(a)}
function testConnectivity(){var a=!1,b=cy.$("node").first(),d=cy.$("node");console.log("Root node: "+b.data("id"));var c=cy.collection(),c=c.add(b);cy.elements().dfs({roots:b,visit:function(a,b,d){c=c.add(d);console.log("visit "+this.id()+" total "+a)},directed:!0});console.log("Total nodes:"+d.size()+" Connected_nodes: "+c.size());if(d.size()==c.size())a=!0;else{var e=d.diff(c).left;console.log("Disconnected:",e.size());console.log("left: "+e.map(function(a){return a.id()}).join(", "));e.addClass("disconnected");
setTimeout(function(){e.removeClass("disconnected")},3E3)}return a};
