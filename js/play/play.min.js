var events={},selected_event=null;function deleteEvent(){null!=selected_event&&$(selected_event).remove()}
function eventManager(){this.page_time=0;this.timerloop;this.event_queue=[];this.next_event;this.loadPageEvents=function(a){this.event_queue=[];for(var b=0;b<a.length;b++)console.log(a[b].id,a[b].eventtype),this.event_queue.push(a[b]);console.log("Page events: ");console.log(this.event_queue);this.next_event=this.event_queue.shift();return a.length+1};this.checkEventTriggers=function(){return"undefined"!==typeof this.next_event&&this.next_event.trigger<this.page_time?(this.runEvent(),this.next_event=
this.event_queue.shift(),1):0};this.runEvent=function(){var a=this.next_event;if("audioevent"==a.eventtype){var b=project_project.audio.getAsset(a.id);"Play"==a.action?(console.log("Play audio event: ",a.name),b.playAudio()):"Volume"==a.action?(0>a.setting?a.setting=0:100<a.setting&&(a.setting=100),console.log("Modify Volume: ",a.setting),b.setVolume(a.setting)):"Stop"==a.action?(console.log("Stop audio event: ",a.name),b.stopAudio()):"Fade Out"==a.action?(console.log("Fade Out audio event: ",a.name),
b.fadeOutAudio()):"Fade In"==a.action?(console.log("Fade In audio event: ",a.name),b.fadeInAudio()):console.log("Next audio event unknown")}else console.log("Trying to run an event, but don't know what eventtype it is! ",a.eventtype)};this.tick=function(){this.checkEventTriggers();this.timerloop=setInterval(function(){this.page_time++;0===this.checkEventTriggers()&&(this.clearTimer(),console.log("Clearing"))}.bind(this),1E3)};this.clearTimer=function(){clearInterval(this.timerloop)};this.newPage=
function(a){0!==this.loadPageEvents(a)&&this.tick();this.page_time=0}}var audio={};
function audioAsset(a,b,c,d){this.name=a;this.id=b;this.type=d;this.link=c;this.player=null;this.loadAudio=function(){if("youtube"==this.type){var a=this.link.match(/(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?\/ ]{11})/i);this.createYoutubePlayer(a[1]);console.log("youtube audio loaded with ID: ",a[1])}else{if("mp3"==this.type)return"Some other HTML string!";alert("You shouldn't be here...")}};this.playAudio=function(){"youtube"==this.type&&this.player.playVideo()};
this.setVolume=function(a){"youtube"==this.type&&this.player.setVolume(a)};this.stopAudio=function(){"youtube"==this.type&&this.player.stopVideo()};this.fadeOutAudio=function(){if("youtube"==this.type)var a=this.player.getVolume(),b=0,c=setInterval(function(){if(50>b&&0!==a){b++;var d=1-Math.pow(1-Math.pow(1-b/50,2),1.5);console.log("curve value: ",a*d);this.player.setVolume(a*d)}else clearInterval(c),this.player.stopVideo(),this.player.setVolume(a)}.bind(this,a,b,50),100)};this.fadeInAudio=function(){if("youtube"==
this.type){var a=this.player.getVolume(),b=0;this.player.playVideo();this.player.setVolume(0);var c=setInterval(function(){if(50>b){b++;var d=Math.pow(1-Math.pow(1-b/50,2),1.5);console.log("curve value: ",a*d);this.player.setVolume(a*d)}else clearInterval(c)}.bind(this,a,b,50),100)}};this.createYoutubePlayer=function(a){$("#playwindow #audioplayerlist").append("<div id = 'youtube"+this.id+"'></div>");this.player=new YT.Player("youtube"+this.id,{origin:"https://www.youtube.com",height:"0",width:"0",
videoId:a,events:{onReady:function(a){console.log("Player ready",project_project.audio.loaded++);project_project.audio.loaded==project_project.audio.assets.length&&loadingScreen(!1)},onStateChange:function(a){-1===a.data&&console.log("youtube video not started");5===a.data&&console.log("youtube video queued");1===a.data&&console.log("now playing");0===a.data&&console.log("Video ended")},onError:function(b){alert("Youtube audio playback encountered error: ",b.data,". Embedding of this link: "+a+" may be disabled by the owner.");
this.player.destroy();console.log("Destroying player")}}})};this.addEvent=function(){$("#eventspane").append("<div id = '"+this.id+"' class='audioevent eventscontainer'><span class = 'eventname flex-center-vertically'>"+this.name+"</span><span class = 'eventtype flex-center-vertically'><select><option value='Play'>Play</option><option value='Fade In'>Fade In</option><option value='Stop'>Stop</option><option value='Fade Out'>Fade Out</option><option value='Volume'>Volume</option></select><input class='setting' type='number' min = 0 max = 100 value = 100></span><span class = 'eventtrigger'><input type='number' min = 0 value = 0></span></div>");
this.eventListBehaviour();$(".eventscontainer").last().find("select").material_select()};this.eventListBehaviour=function(){var a=$(".eventscontainer").last();a.find(".eventtype").on("change","select",function(a){"Volume"==$(this).val()?$(this).parent().siblings(".setting").show():$(this).parent().siblings(".setting").hide()});a.on("click",".eventname",function(a){a.preventDefault();$(".eventscontainer").removeClass("highlighted");$(this).parent().toggleClass("highlighted");selected_event=$(this).parent();
console.log(selected_event)})}}
function audioObj(){this.selected_audio=null;this.unique_id=0;this.assets=[];this.loaded=0;this.changed=!1;this.getAssetAsModalList=function(a){var b="";if(void 0!=a)a=this.assets[a],b+="<li id='"+a.id+"''>"+a.name+"<br>"+a.link+"</li>";else for(var c=0;c<this.assets.length;c++)a=this.assets[c],b+="<li id='"+a.id+"''>Name: "+a.name+"<br>Link: "+a.link+"</li>";return b};this.getAssetAsMenu=function(){assetlist={};console.log("Generate audio menu of length: ",this.assets.length);for(var a=0;a<this.assets.length;a++)assetlist[a]=
{name:this.assets[a].name,id:this.assets[a].id,callback:function(a,c){project_project.audio.assets[a].addEvent()}};return assetlist};this.getAsset=function(a){if(void 0!==a){var b=parseInt(a);return 0<=b?this.assets.find(function(a){return a.id===b}):!1}return this.assets};this.removeAsset=function(){this.changed=!0;if(null!=this.selected_audio){var a=this.getAsset(this.selected_audio);this.assets.splice(this.assets.indexOf(a),1);$("#audiolist").find("#"+this.selected_audio).remove()}};this.addAssetButton=
function(){var a=this;myModal.prompt("Add audio assett","Supports youtube links that allow embedding",[{name:"Name","default":"",type:"text"},{name:"Link","default":"https://www.youtube.com/watch?v=4vKmEmY8ZD8",type:"text"}],function(a){$("#audiolist li").on("click",function(a){a.preventDefault();$("#audiolist li").removeClass("highlighted");$(this).toggleClass("highlighted");project_project.audio.selected_audio=$(this).attr("id")})},function(b){return""==b[0]||null==b[0]?"Name can't be empty":""==
b[1]||null==b[1]?"URL can't be empty":a.addAsset(b[0],b[1])?!0:"Audio could not be added correctly, make sure it is in the form of a youtube link"})};this.addAsset=function(a,b){var c=this.parseType(b);if("error"!==c)return this.changed=!0,this.assets[this.assets.length]=new audioAsset(a,this.unique_id,b,c),$("#audiolist").html(""),$("#audiolist").append(this.getAssetAsModalList()),this.unique_id++,!0;console.log("Failed to add asset");return!1};this.parseType=function(a){return a.match(/^(?:https?:\/\/)?(?:www\.)?(?:youtu\.be\/|youtube\.com\/(?:embed\/|v\/|watch\?v=|watch\?.+&v=))((\w|-){11})(?:\S+)?$/)&&
RegExp.$1?"youtube":"error"};this.addAudioEvent=function(a){this.assets[a].addEvent()}}function loadAudioObject(a){var b=new audioObj;b.selected_audio=a.selected_audio;b.unique_id=0;b.loaded=a.loaded;if(0==a.assets.length)b.changed=!1;else{b.changed=!0;for(var c=0;c<a.assets.length;c++)b.addAsset(a.assets[c].name,a.assets[c].link)}return b}var users={};function users_generateNewUser(){return{username:"none",password:"none"}}
function users_getUsername(){return window.localStorage.getItem("token")?JSON.parse(window.localStorage.getItem("token")).user:"INVALID"}function users_setToken(a){$.when(window.localStorage.setItem("token",JSON.stringify(a))).done()}function users_flushToken(){window.localStorage.setItem("token","")}function users_getToken(){return window.localStorage.getItem("token")?JSON.parse(window.localStorage.getItem("token")):"INVALID"}var navigation={},nav_isProject=!1;
function nav_toLogin(){nav_isProject=!1;nav_hideProjects();nav_hideMain();nav_navBarLoggedOut();nav_showLogin()}function nav_toProjects(){nav_hideLogin();nav_hideMain();nav_navBarLoggedIn();nav_showProjects()}function nav_toMain(){nav_hideLogin();nav_hideProjects();nav_showMain()}function nav_hideLogin(){$("#requestLogin").hide()}function nav_hideProjects(){$("#projects").hide()}function nav_hideMain(){$("#mainContent").hide()}function nav_showLogin(){$("#requestLogin").show()}
function nav_showProjects(){!0===nav_isProject?(console.log("isProject"),$("#currentProject").hasClass("hide")&&$("#currentProject").removeClass("hide"),$("#currentProject").show()):console.log("noProject");$("#projects").hasClass("hide")&&$("#projects").removeClass("hide");$("#projects").show()}function nav_showMain(){$("#mainContent").hasClass("hide")&&$("#mainContent").removeClass("hide");$("#mainContent").show();resizeCanvas()}
function nav_navBarLoggedIn(){$(".profile_button").text(users_getUsername());$(".login_button").hide();$(".signup_button").hide();$(".project_button").hasClass("hide")&&$(".project_button").removeClass("hide");$(".project_button").show();$(".settings_button").hasClass("hide")&&$(".settings_button").removeClass("hide");$(".settings_button").show();$(".profile_button").hasClass("hide")&&$(".profile_button").removeClass("hide");$(".profile_button").show()}
function nav_navBarLoggedOut(){$(".profile_button").text("");$(".project_button").hide();$(".profile_button").hide();$(".settings_button").hide();$(".login_button").show();$(".signup_button").show()}var host={},host_location="http://localhost:3000/";function host_create(){return host_location+"create.html"}function host_browse(){return host_location+"browse.html"}function host_play(){return host_location+"play/"}var initCanvas={};console.log("Enter initCanvas.js");
var states={DEFAULT:0,CONNECTING:1,NEWPAGE:2,NEWCONTROL:3},cy=cytoscape({container:document.getElementById("cy"),layout:{},style:[{selector:"node",style:{label:"data(name)","text-opacity":1,"text-valign":"center","text-halign":"center","text-background-shape":"roundrectangle","border-width":2,"border-color":"black","transition-property":"border-width, border-color","transition-duration":"0.8s"}},{selector:"edge",style:{label:"data(name)","text-background-color":"white","text-background-opacity":1,
"text-border-opacity":1,"text-border-color":"#90caf9","text-border-width":2,width:4,"target-arrow-shape":"triangle","line-color":"#90caf9","target-arrow-color":"#89b9e8","curve-style":"bezier","line-style":"solid"}},{selector:":parent",style:{label:"data(name)",shape:"roundrectangle","background-color":"#DDD","background-opacity":"1","padding-top":"10px","padding-left":"10px","padding-bottom":"10px","padding-right":"10px","text-background-color":"white","text-background-opacity":1,"text-halign":"center",
"text-valign":"top","text-events":"yes","text-border-opacity":1,"text-border-color":"black","text-border-width":"2px","transition-property":"text-valign","transition-duration":"0.8s"}},{selector:".named",style:{label:"data(name)","text-background-color":"white","text-background-opacity":1,"text-border-opacity":1,"text-border-color":"black","text-border-width":"2px"}},{selector:".expanded",style:{}},{selector:".collapsed",style:{}},{selector:".hidden",style:{opacity:"0"}},{selector:".page",style:{shape:"roundrectangle",
"background-color":"#aaaaaa"}},{selector:".jump",style:{width:35,height:35,shape:"polygon","shape-polygon-points":[0,-1,-1,.5,1,.5],"background-color":"#FFBB89","text-background-color":"white","text-background-opacity":1,"text-background-shape":"roundrectangle","text-halign":"center","text-valign":"top","text-border-opacity":1,"text-border-color":"black","text-border-width":"2px"}},{selector:".jumpend",style:{width:35,height:35,shape:"polygon","shape-polygon-points":[0,1,-1,-.5,1,-.5],"background-color":"#FFBB89"}},
{selector:".control",style:{shape:"ellipse","background-color":"#7E9ED8"}},{selector:".source_node",style:{"border-width":7,"border-color":"#90caf9","transition-duration":"0.1s"}},{selector:".disconnected",style:{"border-width":7,"border-color":"red","transition-property":"border-width, border-color","transition-duration":"0.1s"}},{selector:".jumpenderror",style:{"border-width":7,"border-color":"orange","transition-property":"border-width, border-color","transition-duration":"0.1s"}},{selector:".start",
style:{width:40,height:40,"background-color":"#9deaa6","padding-left":"2px","padding-right":"2px"}},{selector:".leaf",style:{width:35,height:35,shape:"octagon","background-color":"#eacd9d"}},{selector:".jumpedge",style:{label:"","text-background-opacity":0,"text-border-opacity":0,"text-border-width":0,"line-color":"#FFBB89","target-arrow-color":"#FFBB89","text-border-color":"#FFBB89"}},{selector:".pageedge",style:{}},{selector:".success-edge",style:{"line-color":"#a1d490","target-arrow-color":"#a1d490",
"text-border-color":"#a1d490"}},{selector:".fail-edge",style:{"line-color":"#c390d4","target-arrow-color":"#c390d4","text-border-color":"#c390d4"}},{selector:".parent-selected",style:{"line-style":"dashed"}},{selector:":selected",style:{"text-border-color":"black","border-width":5,"line-color":"black","target-arrow-color":"black","transition-duration":"0.1s"}}],boxSelectionEnabled:!0,selectionType:"single",minZoom:.2,maxZoom:5});cy.panzoom();resizeCanvas();console.log("Canvas done");
var httpRequests={};console.log("Enter httpRequests.js");function http_redirectHome(){window.location=host_create()}function http_save(a,b){http_addTokenToHeader();return $.ajax({type:"POST",url:"/saveProject",data:{save:JSON.stringify(a)},success:function(a){http_handleAuth(a)?b.data=!0:(b.data=!1,console.log(a))},contenttype:"application/json"})}
function http_load(a){a=a.split("_").join(" ");http_addTokenToHeader();var b=cy.elements();cy.remove(b);$.ajax({url:"/getProject",data:{projectOwner:users_getUsername(),projectName:a},cache:!1,type:"GET",success:function(a){if(http_handleAuth(a)){delete a[0]._id;project_project=a[0];project_project.audio=loadAudioObject(project_project.audio);loadTemplateMenuObj();$("#UI_projName").text("Project: "+project_project.projectName);for(var b=0;b<a[0].graph.length;b++)"edges"!==a[0].graph[b].group&&cy.add(a[0].graph[b]);
for(b=0;b<a[0].graph.length;b++)if("edges"==a[0].graph[b].group)cy.add(a[0].graph[b]).on("tap",function(a){this.select()});Materialize.toast("Project '"+project_project.projectName+"' Loaded",3E3,"rounded");resizeCanvas();defaultState()}},contenttype:"application/json"})}function http_setupCy(){for(var a=0;a<project_project.graph.length;a++)if("edges"==project_project.graph[a].group)cy.add(project_project.graph[a]).on("tap",function(a){this.select()});else cy.add(project_project.graph[a])}
function http_getUsersProjects(a,b){http_addTokenToHeader();return $.ajax({url:"/getUsersProjects",data:{username:a},cache:!1,type:"GET",success:function(a){http_handleAuth(a)&&(0<a.projects.length&&(b.projects=a.projects),console.log(a))},contenttype:"application/json"})}
function http_deleteProject(a,b){b=b.split("_").join(" ");http_addTokenToHeader();return $.ajax({type:"POST",url:"/deleteProject",data:{username:a,projName:b},success:function(a){http_handleAuth(a)},contenttype:"application/json"})}function http_signUp(a,b){return $.ajax({url:"/signUp",data:{data:a},cache:!1,type:"POST",success:function(a){http_handleAuth(a)},contenttype:"application/json"})}
function http_login(a,b,c){return $.ajax({url:"/login",data:{uname:a,pwd:b},cache:!1,type:"POST",success:function(a){c.data=a},contenttype:"application/json"})}function http_handleAuth(a){return"EXPIRED"===a||"NO_TOKEN"===a||"AUTH_ERROR"===a?("EXPIRED"===a?console.log("http_handleAuth(): Token is expired"):"AUTH_ERROR"===a?console.log("http_handleAuth(): auth error"):console.log("http_handleAuth(): No Token"),users_flushToken(),http_redirectHome(),!1):!0}
function http_getProjectsForBrowser(a){http_addTokenToHeader();return $.ajax({url:"/getAllUsersProjects",cache:!1,type:"GET",success:function(a){http_handleAuth(a)},contenttype:"application/json"})}
function http_validateToken(){http_addTokenToHeader();return $.ajax({url:"/validateToken",cache:!1,type:"GET",success:function(a){"EXPIRED"===a||"NO_TOKEN"===a||"AUTH_ERROR"===a?("EXPIRED"===a?console.log("http_handleAuth(): Token is expired"):"AUTH_ERROR"===a?console.log("http_handleAuth(): auth error"):console.log("http_handleAuth(): No Token"),users_flushToken()):(console.log("USER IS ALREADY LOGGED IN"),$("#profile_button").text(users_getUsername()),projectSettings_prepThenNavToProjects(project_project))},
contenttype:"application/json"})}function http_addTokenToHeader(){var a=window.localStorage.getItem("token");a&&(a=JSON.parse(a).token,$.ajaxSetup({headers:{"x-access-token":a}}))}var generalOverlay={};
$(document).ready(function(){$(".modal-trigger").leanModal({dismissible:!0,ready:function(){var a=cy.$(":selected")[0];null!=a&&(a.hasClass("page")?(openEditPageOverlay(a),console.log("Opening page overlay")):a.isEdge()?(openEditConnectionOverlay(a),console.log("Opening Edge Overlay")):a.hasClass("control")?(openEditControlOverlay(a),console.log("Opening Control Overlay")):a.hasClass("jump")&&openEditJumpOverlay(a))},complete:function(){closeOverlay(null)}})});
function openEditPageOverlay(a){var b=a;null===a&&(b=cy.$(":selected")[0],$("#pagetoolbar").show(),$("#pagename").text("Page "+a.data("name")));b.hasClass("page")&&(populatePageOverlay(b),$("#pagecontainers").width(project_project.resolution.x),$("#pagecontainers").height(project_project.resolution.y),resizePageContainerDiv())}function openEditConnectionOverlay(a){var b=a;null===a&&(b=cy.$(":selected")[0]);populateEdgeOverlay(b.json())}
function openEditControlOverlay(a){var b=a;null===a&&(b=cy.$(":selected")[0]);$("#controlcontainers #controltext").val(escapeHtml(b.data("text")));populateControlOverlay(b)}function openEditJumpOverlay(a){var b=a;null===a&&(b=cy.$(":selected")[0]);populateJumpOverlay(b)}function openAttributesOverlay(){$("#attributes-modal").openModal({dismissible:!0,ready:function(){gameAttributes_loadAttributes()},complete:function(){gameAttributes_saveAttributes()}})}
function openInventoryDefinitionOverlay(){$("#inventory-definition-modal").openModal({dismissible:!0,ready:function(){gameInventory_createModule_populateItemsList()},complete:function(){$(".inventory-item-list").empty()}})}
function openAudioOverlay(){console.log("Audio overlay opened");$("#audio-modal").openModal({dismissible:!0,ready:function(){project_project.audio.selected_audio=null;$("#audiolist").html("");$("#audiolist").append(project_project.audio.getAssetAsModalList());$("#audiolist li").on("click",function(a){a.preventDefault();$("#audiolist li").removeClass("highlighted");$(this).toggleClass("highlighted");project_project.audio.selected_audio=$(this).attr("id")})},complete:function(){}})}
function closeOverlay(a){var b=a;null===a&&(b=cy.$(":selected")[0]);null!=b?b.hasClass("page")?savePage(b):b.hasClass("control")?(saveControl(b),$("#connectedEdgesList").children().remove()):b.hasClass("jump")?saveJump(b):b.isEdge()&&(saveEdge(b,"EDGE_OVERLAY"),$("#conditionsList").children().remove(),$("#outcomesList").children().remove()):($("#projName").val(""),$("#projNameAcceptButton").hasClass("disabled")||$("#projNameAcceptButton").addClass("disabled"))}
function showOverlayLinks(a){$(".editbutton").hide();a.isNode()?($(".editname").show(),a.isChild()&&$(".removeparent").show(),a.hasClass("page")?($('button[data-target="page-modal"]').show(),$(".setstart").show()):a.hasClass("control")?$('button[data-target="control-modal"]').show():a.hasClass("jump")&&$('button[data-target="jump-modal"]').show()):a.hasClass("pageedge")?$('button[data-target="connection-modal"]').show():a.hasClass("controledge")&&$('button[data-target="connection-modal"]').show()}
function nameNode(a){myModal.prompt("Name Node","Give a unique name to this entity",[{name:"Name","default":a.data("name"),type:"text"}],function(b){b=b[0];a.addClass("named");a.data("name",b)},function(b){var c=!0;if(""==b[0])c=!1;else{var d;a.hasClass("jump")?d=".jump":a.hasClass("page")||a.hasClass("control")?d=".page, .control":a.isParent()&&(d=":parent");cy.nodes(d).each(function(d,f){a!==f&&(console.log("check ",b[0]+" against",f.data("name")),b[0]==f.data("name")&&(console.log("found duplicate"),
c="Another node shares this name"))})}return c})}function escapeHtml(a){var b=document.createElement("div");b.appendChild(document.createTextNode(a));return b.innerHTML}function htmlToElements(a){var b=document.createElement("template");b.innerHTML=a;return b.content.childNodes}
function resizePageContainerDiv(){$("#pagecontainers").width(project_project.resolution.x);$("#pagecontainers").height(project_project.resolution.y);var a;if($("#page-modal").hasClass("open")){a=$(".screenwrapper").width();var b=$(".screenwrapper").height(),c=$("#pagecontainers").width(),d=$("#pagecontainers").height();a=Math.min(a/c,b/d);$("#pagecontainers").css({transform:"scale("+a+")"});$("#pagecontainers").css({"-ms-transform":"scale("+a+")"});$("#pagecontainers").css({"-webkit-transform":"scale("+
a+")"})}}var prompts={};
function myModal(){this.confirm=!1;this.validated=!0;this.callbackFunction=this.verifyFunction=null;this.init=function(){$("body").append('<div id="prompt-modal" class=" modal"><div class="modal-content"></div><div class="modal-footer"><a href="#!" class=" modal-action modal-close waves-effect waves-red btn-flat onclick="myModal.evaluateModal(false)">Cancel</a><a href="#!" class=" modal-action waves-effect waves-green btn-flat" onclick="myModal.evaluateModal(true)">Confirm</a></div></div>')};this.evaluateModal=
function(a){console.log("Button pressed");this.confirm=a;var b=[];if(this.confirm)if($("#prompt-modal .modal-content").children(".input-field").each(function(a){a=$(this).children("input");"number"==a.attr("type")?(console.log("We got a number entry"),b.push(parseFloat(a.val()))):b.push(a.val())}),null!==this.verifyFunction){console.log("Results: ");for(a=0;a<b.length;a++)console.log(b[a]);a=this.verifyFunction(b);!0===a?(this.callbackFunction(b),$("#prompt-modal").closeModal()):void 0!==a&&this.warning(a)}else this.callbackFunction(b),
$("#prompt-modal").closeModal();else $("#prompt-modal").closeModal()};this.prompt=function(a,b,c,d,e){var f=$("#prompt-modal .modal-content");this.verifyFunction=void 0!==e?e:null;this.callbackFunction=d;f.html("");a=""+('<h3 style="text-align:center;">'+a+"</h3>");if(Array.isArray(b))for(a+='<p id="promptDesc">'+b[0]+"</p>",d=1;d<b.length;d++)a+="<p>"+b[d]+"</p>";else a+='<p id="promptDesc">'+b+"</p>";for(d=0;d<c.length;d++)"number"==c[d].type?(a+='<div class="input-field">',a+='<label for="'+d+
'"> '+c[d].name+'</label><input id= "'+d+'"type="'+c[d].type+'" value = "'+parseFloat(c[d]["default"])+'" min ="'+c[d].min+'" max ="'+c[d].max+'">'):(a+='<div class="input-field">',a+='<label for="'+d+'"> '+c[d].name+'</label><input id= "'+d+'"type="'+c[d].type+'" value = "'+c[d]["default"]+'">'),a+="</div>";f.append(a);$("#prompt-modal .modal-content input").eq(0).prop("autofocus",!0);$("#prompt-modal").openModal({dismissible:!1,ready:function(){Materialize.updateTextFields()},complete:function(){this.confirm=
!1;this.validated=!0;this.callbackFunction=this.verifyFunction=null;f.html("")}})};this.warning=function(a){$("#promptDesc").css("color","red");!1!==a&&$("#promptDesc").text(a)}}myModal=new myModal;myModal.init();var projectSettings={},projectSettings_activePage=1,projectSettings_amtPages=1,projectSettings_userProjects={projects:[]};
function projectSettings_prepThenNavToProjects(a){console.log(a);$("#currentProject_header").text("Current Project: "+a.projectName);$("#currentProject_title").text(a.title);$("#currentProject_author").text(a.author);$("#currentProject_desc").text(a.description);$("#currentProject_dateCreated").text(a.dateCreated);$("#currentProject_lastModified").text(a.lastModified);$("#currentProject_published").text(a.published);$("#currentProject_imageLink").text(a.imageLink);$("#currentProject_backgroundImageLink").text(a.backgroundLink);
$("#currentProject_resolution").text("Width: "+a.resolution.x+"px Height: "+a.resolution.y+"px");!0===a.published?($("#currentProject_gameLink").attr("href",a.gameLink),$("#currentProject_gameLink").text(a.gameLink),$("#currentProject_noGameLink").hide(),$("#currentProject_gameLink").show(),$("#pubSwitch").prop("checked",!0)):($("#currentProject_gameLink").hide(),$("#currentProject_noGameLink").show(),$("#pubSwitch").prop("checked",!1));"none"!==a.projectName&&(nav_isProject=!0);$.when(projectSettings_prepareProjectsPage()).done(nav_toProjects())}
function projectSettings_prepThenNavToMain(a){$.when(http_load(a)).done(function(){nav_isProject=!0;resizeCanvas();defaultState();nav_toMain();projectSettings_activePage=1})}
function projectSettings_prepareProjectsPage(){projectSettings_activePage=1;projectSettings_userProjects={projects:[]};console.log("showing "+users_getUsername()+"projects");$.when(http_getUsersProjects(users_getUsername(),projectSettings_userProjects)).done(function(){console.log(projectSettings_userProjects);projectSettings_populateProjectsList(users_getUsername(),1)})}
function projectSettings_populateProjectsList(a,b){console.log("populateProjectsList called");$("#projectsList1").empty();$("#projectsList2").empty();projectSettings_populateProjectPage(projectSettings_userProjects,b)}
function projectSettings_populateProjectPage(a,b){console.log("all projects: ");console.log(a);0===a.projects.length&&console.log("projectSettings_populateProjectPage() error: projNames[] is null");$(".pp").remove();projectSettings_amtPages=Math.ceil(a.projects.length/4);for(var c="",d=1;d<=projectSettings_amtPages;d++){var e="pp_"+d;0===$("#"+e).length&&(c=d===b?c+('<li id="'+e+'" class="active pp"><a onclick=projectSettings_switchPage('+d+")>"+d+"</a></li>"):c+('<li id="'+e+'" class="waves-effect pp"><a onclick=projectSettings_switchPage('+
d+")>"+d+"</a></li>"))}$("#projectsPaginationLeft").after(c);1===projectSettings_activePage&&projectSettings_amtPages>projectSettings_activePage?(projectSettings_disableLeftPagination(),projectSettings_enableRightPagination()):1===projectSettings_activePage&&projectSettings_amtPages===projectSettings_activePage?(projectSettings_disableLeftPagination(),projectSettings_disableRightPagination()):projectSettings_activePage===projectSettings_amtPages?(projectSettings_disableRightPagination(),projectSettings_enableLeftPagination()):
(projectSettings_enableLeftPagination(),projectSettings_enableRightPagination());c=1===b?4:4*b;d=c-4;c>a.projects.length&&(c=a.projects.length);for(console.log("range: "+d+" "+c);d<c;d++)2>$("#projectsList1 li").length?$("#projectsList1").append(projectSettings_generateProjectCard(a.projects[d])):$("#projectsList2").append(projectSettings_generateProjectCard(a.projects[d]));$(".pubTT").tooltip({delay:50})}
function projectSettings_generateProjectCard(a){return'<li><div class="col s1"><p></p></div><div class="card hoverable col s4" style="height: 200px;"><div class="card-content"><span class="card-title activator grey-text text-darken-4" style="position: relative;">'+a.projName+'<i class="material-icons right">more_vert</i></span><div class="row"><p>Title: '+a.title+'</p></div><div class="row"><p>Author: '+a.author+'</p></div><div class="row" ><a href="#" class="btn col s8 offset-s2" onclick=projectSettings_prepThenNavToMain(\''+
a.projName+'\')>Load</a></div></div><div class="card-reveal" ><span class="card-title grey-text text-darken-4">'+a.projName+'<i class="material-icons right">close</i></span><p>Date Created: '+a.dateCreated+"</p><p>Last Modified: "+a.lastModified+"</p>"+(!0===a.published?'<div id="'+a.projName+'_pub"><p style="color: green;">Published</p><p>Link to play game:<span><a href="'+a.gameLink+'" target="_blank">'+a.gameLink+"</a></span></p></div>":'<p id="'+a.projName+'_pub" class="pubTT tooltipped" data-position="bottom" data-delay="50" data-tooltip="Load your project and view the settings tab to publish your project for the world to see!" style="color: red;">Project is not published</p>')+
'<a class="btn-floating btn-small waves-effect waves-light red" onclick=projectSettings_deleteProject(\''+users_getUsername()+"','"+a.projName+'\')><i class="small material-icons">delete</i></a></div></div></li>'}
function projectSettings_switchPage(a,b){0>a||$(b).hasClass("disabled")||($("#pp_"+projectSettings_activePage).removeClass("active"),$("#pp_"+projectSettings_activePage).addClass("waves-effect"),$("#pp_"+a).removeClass("waves-effect"),$("#pp_"+a).addClass("active"),projectSettings_activePage=a,projectSettings_populateProjectsList(users_getUsername(),a))}
function projectSettings_enableLeftPagination(){$("#projectsPaginationLeft").hasClass("disabled")&&($("#projectsPaginationLeft").addClass("waves-effect"),$("#projectsPaginationLeft").removeClass("disabled"))}function projectSettings_disableLeftPagination(){$("#projectsPaginationLeft").hasClass("disabled")||($("#projectsPaginationLeft").addClass("disabled"),$("#projectsPaginationLeft").removeClass("waves-effect"))}
function projectSettings_enableRightPagination(){$("#projectsPaginationRight").hasClass("disabled")&&($("#projectsPaginationRight").addClass("waves-effect"),$("#projectsPaginationRight").removeClass("disabled"))}function projectSettings_disableRightPagination(){$("#projectsPaginationRight").hasClass("disabled")||($("#projectsPaginationRight").addClass("disabled"),$("#projectsPaginationRight").removeClass("waves-effect"))}
function projectSettings_deleteProject(a,b){var c=b.split("_").join(" ");myModal.prompt("Delete Project '"+c+"'.","Are you sure you wish to delete this project? This cannot be undone.",[],function(d){projectSettings_activePage=1;$.when(http_deleteProject(a,b)).done(function(){projectSettings_userProjects={projects:[]};$.when(http_getUsersProjects(a,projectSettings_userProjects)).done(function(){projectSettings_populateProjectsList(a,1);Materialize.toast("Project '"+c+"' Deleted",3E3,"rounded")})})},
function(a){return!0})}states={DEFAULT:0,CONNECTING:1,NEWPAGE:2,NEWCONTROL:3,NEWJUMP:4,NEWJUMPEND:5,NEWEMPTY:6,NEWFIGHT:7,NEWSTORE:8};current_state=states.DEFAULT;function defaultState(){exitStates();current_state=states.DEFAULT}function exitStates(){current_state==states.CONNECTING&&(cy.boxSelectionEnabled(!0),null!==source_node&&(source_node.removeClass("source_node"),source_node=null));$("#sidebar .btn").removeClass("activebutton");$(".pagemode").html("Page Node");cy.$(":parent").selectify()}
function changeState(a){exitStates();$(a).addClass("activebutton");$(a).hasClass("connectionmode")&&current_state!=states.CONNECTING?(current_state=states.CONNECTING,console.log("changestate unselect"),cy.$(":selected").unselect(),cy.$(":parent").unselectify(),cy.boxSelectionEnabled(!1),source_node=null):$(a).hasClass("pagemode")&&current_state!=states.NEWPAGE?exitStates():$(a).hasClass("controlmode")&&current_state!=states.NEWCONTROL?current_state=states.NEWCONTROL:$(a).hasClass("jumpmode")&&current_state!=
states.NEWJUMP!=states.NEWJUMP?current_state=states.NEWJUMP:$(a).hasClass("jumpmode")&&current_state!=states.NEWJUMP&&current_state!=states.NEWJUMPEND?exitStates():$(a).hasClass("prebuilt")&&current_state!=states.NEWFIGHT&&current_state!=states.NEWSTORE&&current_state!=states.NEWEMPTY?exitStates():($(a).hasClass("deletebutton")&&removeElement(),current_state=states.DEFAULT,$(a).removeClass("activebutton"))}
function choosePrebuilt(a){$(".prebuilt").addClass("activebutton");"Empty"==a?current_state=states.NEWEMPTY:"Fight"==a?current_state=states.NEWFIGHT:"Store"==a&&(current_state=states.NEWSTORE)}function chooseJump(a){$(".jumpmode").addClass("activebutton");"Start"==a?current_state=states.NEWJUMP:"End"==a&&(current_state=states.NEWJUMPEND)}var project={};console.log("Entering project.js");var project_project=initEmptyProject("none","none");defaultState();
function initEmptyProject(a,b){return{project_templates:{Default:{pagestyle:"width: 800px; flex: 0 0 800px; height:600px; border: 3px solid black",outputcontainer:"",imgcontainers:[],vidcontainers:[],textcontainers:[],decisioncontainers:[],buttoncontainers:[]}},buttons_list:{Default:{html:""}},template_menus:new templateMenuObj,audio:new audioObj,projectOwner:a,projectName:b,dateCreated:project_getCurrentTime(),lastModified:project_getCurrentTime(),published:!1,title:b,author:a,description:"No description available.",
imageLink:"No URL provided",backgroundLink:"No URL provided",gameLink:host_play()+a+"/"+b,graph:[],gameAttributes:{},gameInventory:{},attributesHTML:"",resolution:{x:1E3,y:800}}}
function project_createNewProject(){myModal.prompt("Create New Project","",[{name:"Project Name","default":"",type:"text"}],function(a){},function(a){var b=/^[a-zA-Z0-9_-]+$/;if(""==a[0])myModal.warning("Project name cannot be empty");else if(!1===b.test(a[0]))myModal.warning("Project names can only contain letters, numbers, underscores or hyphens");else{var c={};$.when(http_getUsersProjects(users_getUsername(),c)).done(function(){console.log("RET");console.log(c);if(c.hasOwnProperty("projects"))for(var b=
0;b<c.projects.length;b++)if(a[0].trim()===c.projects[b].projName){myModal.warning("You already have a project named "+c.projects[b].projName+". Please choose another name.");return}project_project=initEmptyProject(users_getUsername(),a[0].trim());cy.elements().remove();var e={data:[]};$.when(http_save(project_project,e)).done(function(){!0===e.data?(Materialize.toast("Project '"+project_project.projectName+"' created!",3E3,"rounded"),$("#prompt-modal").closeModal(),$("#UI_projName").text("Project: "+
project_project.projectName),nav_toMain(),http_getUsersProjects(users_getUsername(),projectSettings_userProjects)):Materialize.toast("Failed to create project. Please log in again.",3E3,"rounded")})})}})}
function project_addTopGameAttributeFolder(a){var b=generateID();project_project.gameAttributes[b]=new GameAttribute(null,null,a,b,!1);a='<li class="'+b+'-list-element margin pointer"><a onclick="gameAttributes_display(\''+b+"')\">"+a+'</a><ul id="'+b+'-inner_list"></ul></li>';$("#attributes-list").append(a);console.log("new top level attribute added: "+project_project.gameAttributes[b].path)}
function project_saveProject(){cy.nodes().removeClass("source_node disconnected jumpenderror");cy.elements().unselect();project_project.graph=cy.elements().jsons();project_project.lastModified=project_getCurrentTime();var a={data:!1};$.when(http_save(project_project,a)).done(function(){!0===a.data?Materialize.toast("Saved project",3E3,"rounded"):Materialize.toast("Failed to save project. Please log in again.",3E3,"rounded")})}
function project_login(){myModal.prompt("Log In","Log in and continue creating!",[{name:"Username","default":"",type:"text"},{name:"Password","default":"",type:"password"}],function(a){},function(a){a[0]=a[0].trim();if(!1===/^[a-zA-Z0-9]+$/.test(a[0]))return myModal.warning("Usernames can only contain letters and numbers"),!1;var b={data:{}};$.when(http_login(a[0],a[1],b)).done(function(){"INVALID_USERNAME"!==b.data&&"INVALID_PASSWORD"!==b.data&&"SERVER_ERR"!==b.data?(project_successfulLogin(b),Materialize.toast("Welcome back "+
users_getUsername()+"!",3E3,"rounded")):myModal.warning("Login details were invalid. Please try again.")})})}function project_successfulLogin(a){users_flushToken();window.localStorage.setItem("token",JSON.stringify(a.data));$("#prompt-modal").closeModal();console.log(users_getUsername()+" logged in");$("#profile_button").text(users_getUsername());projectSettings_prepThenNavToProjects(project_project)}
function project_signUp(){myModal.prompt("Sign Up","Become a game creator with FantasyMaker!",[{name:"Username","default":"",type:"email"},{name:"Password","default":"",type:"password"},{name:"Confirm Password","default":"",type:"password"}],function(a){},function(a){a[0]=a[0].trim();if(""===a[0]||""===a[1]||""===a[2])return myModal.warning("All fields must be filed out."),!1;if(a[1]!==a[2])return myModal.warning("Your password and confirmation password do not match."),!1;if(!1===/^[a-zA-Z0-9]+$/.test(a[0]))return myModal.warning("Usernames can only contain letters and numbers"),
!1;var b=users_generateNewUser();b.username=a[0];b.password=a[1];$.when(http_signUp(b,"")).done(function(c){if("VALID"===c){Materialize.toast("Welcome to FantasyMaker "+a[0]+".",3E3,"rounded");$("#prompt-modal").closeModal();var d={data:{}};$.when(http_login(b.username,b.password,d)).done(function(){"INVALID_USERNAME"!==d.data&&"INVALID_PASSWORD"!==d.data&&"SERVER_ERR"!==d.data?project_successfulLogin(d):myModal.warning("Login details were invalid. Please try again.")})}else myModal.warning("That username has already been taken. Please try another username")})})}
function project_logOut(){myModal.prompt("Log Out","Are you sure you wish to log out? Any unsaved progress will be lost.",[],function(a){console.log(users_getUsername()+" logged out");nav_toLogin();users_flushToken();project_project=initEmptyProject("none","none");http_redirectHome()},function(a){return!0})}function project_getCurrentTime(){var a=new Date,b=a.getDate(),c=a.getMonth()+1,a=a.getFullYear();return b+"-"+c+"-"+a}
function project_modifyTitle(){myModal.prompt("Modify Project Title","Change the title of your project. This will appear as the name of your project in the game browser.",[{name:"Title","default":project_project.title,type:"text"}],function(a){project_project.title=a[0];$("#currentProject_title").text(project_project.title);project_saveProject()},function(a){return""===a[0]?(myModal.warning("Title field cannot be empty."),!1):!0})}
function project_modifyAuthor(){myModal.prompt("Modify Project Author","Change the name that appears as the author of your project in the game browser.",[{name:"Author","default":project_project.author,type:"text"}],function(a){project_project.author=a[0];$("#currentProject_author").text(project_project.author);project_saveProject()},function(a){return""===a[0]?(myModal.warning("Author field cannot be empty."),!1):!0})}
function project_modifyImage(){myModal.prompt("Modify Project Image","Change the image that appears with your project in the game browser.",[{name:"URL","default":project_project.imageLink,type:"text"}],function(a){project_project.imageLink=a[0];$("#currentProject_imageLink").text(project_project.imageLink);project_saveProject()},function(a){return""===a[0]?(myModal.warning("URL field cannot be empty."),!1):!0})}
function project_modifyBackgroundImage(){myModal.prompt("Modify Game Background Image","Change the image that appears in the background when your game is played in the play module.",[{name:"URL","default":project_project.backgroundLink,type:"text"}],function(a){project_project.backgroundLink=a[0];$("#currentProject_backgroundImageLink").text(project_project.backgroundLink);project_saveProject()},function(a){return""===a[0]?(myModal.warning("URL field cannot be empty."),!1):!0})}
function project_modifyResolution(){myModal.prompt("Modify The Target Resolution Of The Project","Change the resolution that you intend your viewers to view this game on.",[{name:"Width","default":project_project.resolution.x,type:"number"},{name:"Height","default":project_project.resolution.y,type:"number"}],function(a){project_project.resolution.x=parseInt(a[0]);project_project.resolution.y=parseInt(a[1]);$("#currentProject_resolution").text("Width: "+project_project.resolution.x+"px Height: "+
project_project.resolution.y+"px");project_saveProject()},function(a){return isNaN(parseInt(a[0]))||isNaN(parseInt(a[1]))?(myModal.warning("Width and height fields cannot be empty."),!1):0>parseInt(a[0])||0>parseInt(a[1])?(myModal.warning("Width and height must be greater than 0"),!1):!0})}
$("#pubSwitch").click(function(){event.preventDefault();res=$("#pubSwitch").prop("checked")?"You have enabled publishing on your project. A published project will be viewable to the world through the game browser.  Click the edit button next to the toggle switch to pusblish this project.":"You have disabled publishing on your project. People will no longer be able to play your game through the game browser.";myModal.prompt("Publish Project",res,[],function(a){console.log(myModal.confirm);a=$("#pubSwitch").prop("checked");
project_project.published=!a;project_project.published?($("#currentProject_gameLink").text(project_project.gameLink),$("#currentProject_gameLink").attr("href",project_project.gameLink),$("#currentProject_gameLink").attr("href",project_project.gameLink),$("#currentProject_gameLink").show(),$("#currentProject_noGameLink").hide(),project_updatePublishedHtml(!0),project_saveProject(),$("#pubSwitch").prop("checked",!0)):(project_updatePublishedHtml(!1),$("#currentProject_gameLink").hide(),$("#currentProject_noGameLink").show(),
project_saveProject(),$("#pubSwitch").prop("checked",!1))},function(a){return!0})});
function project_modifyDesc(){myModal.prompt("Modify Project Description","Change the description of your game that appears with your project in the game browser.",[{name:"Description","default":project_project.description,type:"text"}],function(a){project_project.description=a[0];$("#currentProject_desc").text(project_project.description);project_saveProject()},function(a){return""===a[0]?(myModal.warning("Description field cannot be empty."),!1):!0})}
function project_updatePublishedHtml(a){pubHTML=!0===a?'<div id="'+project_project.projectName+'_pub"><p style="color: green;">Published</p><p>Link to play game:<span><a href="'+project_project.gameLink+'" target="_blank">'+project_project.gameLink+"</a></span></p></div>":'<p id="'+project_project.projectName+'_pub" class="pubTT tooltipped" data-position="bottom" data-delay="50" data-tooltip="Load your project and view the settings tab to publish your project for the world to see!" style="color: red;">Project is not published</p>';
$("#"+project_project.projectName+"_pub").replaceWith(pubHTML);$(".pubTT").tooltip({delay:50})}var conditions={};console.log("Enter conditions.js");function conditions_createCondition(a,b){return{edge:a.data.id,id:getNextConditionID(a),html:b}}function conditions_createOutcome(a,b){return{edge:a.data.id,id:getNextOutcomeID(a),html:b}}function getNextConditionID(a){for(var b=-1,c=0;c<a.data.conditions.length;c++)a.data.conditions[c].id>b&&(b=a.data.conditions[c].id);return++b}
function getNextOutcomeID(a){for(var b=-1,c=0;c<a.data.outcomes.length;c++)a.data.outcomes[c].id>b&&(b=a.data.outcomes[c].id);return++b}var edgeOverlay={},edgeOverlay_newConditionCount=0,edgeOverlay_newOutcomeCount=0,edgeOverlay_selectedEdge;
function populateEdgeOverlay(a){edgeOverlay_newOutcomeCount=edgeOverlay_newConditionCount=0;edgeOverlay_selectedEdge=a;for(var b=0;b<a.data.conditions.length;b++){var c=a.data.conditions[b];console.log(c);edgeOverlay_addExistingCondition("conditionsList",c)}for(b=0;b<a.data.outcomes.length;b++)c=a.data.outcomes[b],edgeOverlay_addExistingOutcome("outcomesList",c)}
function saveEdge(a,b){var c=a.json();setInputFieldValues();for(var d=0;d<c.data.conditions.length;d++){var e=c.data.conditions[d];if(0<$("#exCondition_"+e.edge+"_"+e.id).length){var f=$("#exCondition_"+e.edge+"_"+e.id).html();e.html=f}}for(d=0;d<c.data.outcomes.length;d++)e=c.data.outcomes[d],0<$("#exOutcome_"+e.edge+"_"+e.id).length&&(f=$("#exOutcome_"+e.edge+"_"+e.id).html(),e.html=f);if("EDGE_OVERLAY"===b){for(d=0;d<edgeOverlay_newConditionCount;d++)0<$("#newCondition_"+d).length&&($("#newCondition_"+
d).html(),e=conditions_createCondition(c,null),$("#newCondition_"+d+"_settings").attr("id","exCondition_"+e.edge+"_"+e.id+"_settings"),$("#newCondition_"+d).attr("id","exCondition_"+e.edge+"_"+e.id),$("#newCondition_"+d+"_attButton_s1_1").attr("id","exCondition_"+e.edge+"_"+e.id+"_attButton_s1_1"),$("#newCondition_"+d+"_compMenu_s1").attr("id","exCondition_"+e.edge+"_"+e.id+"_compMenu_s1"),0<$("#newCondition_"+d+"_attButton_s1_2").length?$("#newCondition_"+d+"_attButton_s1_2").attr("id","exCondition_"+
e.edge+"_"+e.id+"_attButton_s1_2"):0<$("#newCondition_"+d+"_specValue_s1_2").length?($("#newCondition_"+d+"_specValue_s1_2").attr("id","exCondition_"+e.edge+"_"+e.id+"_specValue_s1_2"),$("#newCondition_"+d+"_specValue_s1_2_inputField").attr("id","exCondition_"+e.edge+"_"+e.id+"_specValue_s1_2_inputField")):0<$("#newCondition_"+d+"_randValue_s1_2").length&&$("#newCondition_"+d+"_randValue_s1_2").attr("id","exCondition_"+e.edge+"_"+e.id+"_randValue_s1_2"),$("#newCondition_"+d+"_pivot").attr("id","exCondition_"+
e.edge+"_"+e.id+"_pivot"),0<$("#newCondition_"+d+"_attButton_s2_1").length?$("#newCondition_"+d+"_attButton_s2_1").attr("id","exCondition_"+e.edge+"_"+e.id+"_attButton_s2_1"):0<$("#newCondition_"+d+"_specValue_s2_1").length?($("#newCondition_"+d+"_specValue_s2_1").attr("id","exCondition_"+e.edge+"_"+e.id+"_specValue_s2_1"),$("#newCondition_"+d+"_specValue_s2_1_inputField").attr("id","exCondition_"+e.edge+"_"+e.id+"_specValue_s2_1_inputField")):0<$("#newCondition_"+d+"_randValue_s2_1").length&&$("#newCondition_"+
d+"_randValue_s2_1").attr("id","exCondition_"+e.edge+"_"+e.id+"_randValue_s2_1"),$("#newCondition_"+d+"_compMenu_s2").attr("id","exCondition_"+e.edge+"_"+e.id+"_compMenu_s2"),0<$("#newCondition_"+d+"_attButton_s2_2").length?$("#newCondition_"+d+"_attButton_s2_2").attr("id","exCondition_"+e.edge+"_"+e.id+"_attButton_s2_2"):0<$("#newCondition_"+d+"_specValue_s2_2").length?($("#newCondition_"+d+"_specValue_s2_2").attr("id","exCondition_"+e.edge+"_"+e.id+"_specValue_s2_2"),$("#newCondition_"+d+"_specValue_s2_2_inputField").attr("id",
"exCondition_"+e.edge+"_"+e.id+"_specValue_s2_2_inputField")):0<$("#newCondition_"+d+"_randValue_s2_2").length&&$("#newCondition_"+d+"_randValue_s2_2").attr("id","exCondition_"+e.edge+"_"+e.id+"_randValue_s2_2"),0<$("#newCondition_"+d+"_invButton").length&&($("#newCondition_"+d+"_invButton").attr("id","exCondition_"+e.edge+"_"+e.id+"_invButton"),$("#newCondition_"+d+"_existsButton").attr("id","exCondition_"+e.edge+"_"+e.id+"_existsButton")),e.html=$("#exCondition_"+e.edge+"_"+e.id).html(),void 0!==
e&&c.data.conditions.push(e));for(d=0;d<edgeOverlay_newOutcomeCount;d++)0<$("#newOutcome_"+d).length&&(e=conditions_createOutcome(c,null),$("#newOutcome_"+d+"_settings").attr("id","exOutcome_"+e.edge+"_"+e.id+"_settings"),$("#newOutcome_"+d).attr("id","exOutcome_"+e.edge+"_"+e.id),$("#newOutcome_"+d+"_attButton_1").attr("id","exOutcome_"+e.edge+"_"+e.id+"_attButton_1"),$("#newOutcome_"+d+"_compMenu").attr("id","exOutcome_"+e.edge+"_"+e.id+"_compMenu"),$("#newOutcome_"+d+"_attButton_2").attr("id",
"exOutcome_"+e.edge+"_"+e.id+"_attButton_2"),$("#newOutcome_"+d+"_specValue_2").attr("id","exOutcome_"+e.edge+"_"+e.id+"_specValue_2"),$("#newOutcome_"+d+"_specValue_2_inputField").attr("id","exOutcome_"+e.edge+"_"+e.id+"_specValue_2_inputField"),$("#newOutcome_"+d+"_randValue_2").attr("id","exOutcome_"+e.edge+"_"+e.id+"_randValue_2"),$("#newOutcome_"+d+"_text_1").attr("id","exOutcome_"+e.edge+"_"+e.id+"_text_1"),$("#newOutcome_"+d+"_text_2").attr("id","exOutcome_"+e.edge+"_"+e.id+"_text_2"),e.html=
$("#exOutcome_"+e.edge+"_"+e.id).html(),void 0!==e&&c.data.outcomes.push(e))}edgeOverlay_newOutcomeCount=edgeOverlay_newConditionCount=0}function edgeOverlay_addNewCondition(a){var b="newCondition_"+edgeOverlay_newConditionCount,c=generateCondition_type1(b);$("#"+a).append(c);initAttributeButton(b+"_attButton_s1_1");initAttributeButton(b+"_attButton_s1_2");edgeOverlay_newConditionCount++}
function edgeOverlay_addNewOutcome(a){var b="newOutcome_"+edgeOverlay_newOutcomeCount,c=generateOutcome(b);$("#"+a).append(c);initAttributeButton(b+"_attButton_1");initAttributeButton(b+"_attButton_2");edgeOverlay_newOutcomeCount++}
function edgeOverlay_addExistingCondition(a,b){var c="exCondition_"+b.edge+"_"+b.id,d="<li id="+c+">"+b.html+"</li>";$("#"+a).append(d);$("#"+c+"_specValue_s1_2_inputField").val($("#"+c+"_specValue_s1_2_inputField").attr("value"));$("#"+c+"_specValue_s2_1_inputField").val($("#"+c+"_specValue_s2_1_inputField").attr("value"));$("#"+c+"_specValue_s2_2_inputField").val($("#"+c+"_specValue_s2_2_inputField").attr("value"));$("#"+c+"_attButton_s1_1").tooltip({delay:50});$("#"+c+"_attButton_s1_2").tooltip({delay:50});
$("#"+c+"_attButton_s2_1").tooltip({delay:50});$("#"+c+"_attButton_s2_2").tooltip({delay:50});$("#"+c+"_randValue_s1_2").tooltip({delay:50});$("#"+c+"_randValue_s2_1").tooltip({delay:50});$("#"+c+"_randValue_s2_2").tooltip({delay:50});$("#"+c+"_invButton").tooltip({delay:50});$("#"+c+"_randButton").tooltip({delay:50});$("#"+c).hide(0,function(){$("#"+c).show(300)})}
function edgeOverlay_addExistingOutcome(a,b){var c="exOutcome_"+b.edge+"_"+b.id,d="<li id="+c+' class="condition-context-menu">'+b.html+"</li>";$("#"+a).append(d);$("#"+c+"_attButton_1").tooltip({delay:50});$("#"+c+"_attButton_2").tooltip({delay:50});$("#"+c+"_randValue_2").tooltip({delay:50});$("#"+c+"_text_1").tooltip({delay:50});$("#"+c+"_text_2").tooltip({delay:50});$("#"+c).hide(0,function(){$("#"+c).show(300)})}
function removeCondition(a){console.log("Removing condition "+a);var b=a.split("_");$("#"+a).hide(300,function(){$("#"+a).remove()});if("newCondition"!==b[0])if("exCondition"===b[0])for(var c=cy.edges("[id='"+b[1]+"']").json(),d=0;d<c.data.conditions.length;d++)d===parseInt(b[2])&&c.data.conditions.splice(d,1);else console.log("removeCondition(): error in id formatting")}
function removeOutcome(a){console.log("Removing outcome "+a);$("#"+a).hide(300,function(){$("#"+a).remove()});var b=a.split("_");if("newOutcome"!==b[0])if("exOutcome"===b[0])for(var c=cy.edges("[id='"+b[1]+"']").json(),d=0;d<c.data.outcomes.length;d++)d===parseInt(b[2])&&c.data.outcomes.splice(d,1);else console.log("removeOutcome(): error in id formatting")}var controlOverlay={},currentDraggedItem=resetCurentDraggedItem(),currentHoverOver=null,currentSelectedNode=null;
function populateControlOverlay(a){currentDraggedItem=resetCurentDraggedItem();currentHoverOver=null;currentSelectedNode=a;for(var b=0;b<a.json().data.priorityList.length;b++){var c=cy.edges("[id='"+a.json().data.priorityList[b]+"']").json(),d="<li id=connectedEdge_"+c.data.id+' ><div id="header_'+c.data.id+'" draggable="true" ondragend=handleDragEnd(event) ondragstart=handleDrag(event,\''+c.data.name+'\') ondragenter=handleDragEnter(event) class="collapsible-header highlight-list">Edge '+c.data.name+
'<i id="defaultIcon_'+c.data.id+'" class="small material-icons"></i></div><div class="collapsible-body"><ul id = "'+c.data.id+'_collapsible" class="collapsible" data-collapsible="expandable"><li><div class="collapsible-header">Conditions for '+c.data.name+'</div><div class="collapsible-body"><ul id = "controlConditions_'+c.data.id+'" class="list-unstyled" ></ul></div></li><li><div class="collapsible-header">Outcomes for '+c.data.name+'</div><div class="collapsible-body"><ul id = "controlOutcomes_'+
c.data.id+'" class="list-unstyled" ></ul></div></li></ul><div style="text-align: right"><button type="button" class="btn btn-default" onClick=setDefaultFailEdge(\''+c.data.id+'\') style="width: 50%;">Set As Default Fail Edge</button></div>';"</div></li>";$("#connectedEdgesList").append(d);$("#"+c.data.id+"_collapsible").collapsible({accordion:!1});for(d=0;d<c.data.conditions.length;d++)edgeOverlay_addExistingCondition("controlConditions_"+c.data.id,c.data.conditions[d]);for(d=0;d<c.data.outcomes.length;d++)edgeOverlay_addExistingOutcome("controlOutcomes_"+
c.data.id,c.data.outcomes[d])}setDefaultFailEdge(a.json().data.defaultFailEdge);activateHighlightList()}function saveControl(a){a.connectedEdges().forEach(function(a){saveEdge(a,"CONTROL_OVERLAY")});updatePriority(a)}
function updatePriority(a){console.log(a.connectedEdges().jsons());a=a.json().data.priorityList;var b=[];$("#connectedEdgesList li").each(function(a,c){var f=$(c).attr("id");void 0!==f&&(f=f.split("_"),"connectedEdge"===f[0]&&b.push(f[1]))});if(a.length===b.length)for(var c=0;c<a.length;c++)a[c]=b[c]}
function setDefaultFailEdge(a){if(null!==currentSelectedNode&&void 0!==currentSelectedNode){var b="#defaultIcon_"+currentSelectedNode.json().data.defaultFailEdge;$(b).html("");$("#defaultIcon_"+a).html("stars");cy.$("#"+currentSelectedNode.json().data.defaultFailEdge).removeClass("fail-edge");cy.$("#"+currentSelectedNode.json().data.defaultFailEdge).addClass("success-edge");currentSelectedNode.json({data:{defaultFailEdge:a}});cy.$("#"+a).removeClass("success-edge");cy.$("#"+a).addClass("fail-edge");
console.log("new default is "+a)}}
function removeEdgeFromPriorityList(a){var b=cy.nodes("[id='"+a.json().data.source+"']");if(void 0!==b){for(var c=0;c<b.json().data.priorityList.length;c++)b.json().data.priorityList[c]===a.json().data.id&&b.json().data.priorityList.splice(c,1);b.json().data.defaultFailEdge===a.json().data.id&&(0<b.json().data.priorityList.length?(b.json({data:{defaultFailEdge:b.json().data.priorityList[0]}}),setDefaultFailEdge(b.json().data.priorityList[0])):b.json({data:{defaultFailEdge:"none"}}))}}
function handleDrag(a,b){resetFromHighlight(a.target.id);a.dataTransfer.setData("Text","Dropped in zone!");currentHoverOver=a.target.id;$(".collapsible-header.active.highlight-list").each(function(a){$(this).click()});currentDraggedItem.ID=a.target.id;currentDraggedItem.parentID="connectedEdge_"+a.target.id.split("_")[1];currentDraggedItem.name=b}
function handleDragEnter(a){var b='<li id="dropZoneOuter"><div id="dropZone" class="collapsible-header" ondrop=handleDrop(event) ondragover=allowDrop(event) style="font-style: italic; background-color: gray; opacity: 0.25;"> Edge '+currentDraggedItem.name+"</div></li>";currentHoverOver!==a.target.id&&(currentHoverOver=a.target.id,"dropZone"!==currentHoverOver.split("_")[0]&&($("#dropZoneOuter").remove(),"connectedEdgesList"===currentHoverOver?(a=$("ul#connectedEdgesList li:first").attr("id").split("_")[1],
$("#connectedEdge_"+a).before(b)):$("#connectedEdge_"+currentHoverOver.split("_")[1]).after(b),$("#dropZoneOuter").hide(),$("#"+currentDraggedItem.ID).hide(0,function(){$("#dropZoneOuter").show(0)})))}
function handleDrop(a){a.preventDefault();a=$("#"+currentDraggedItem.parentID).clone();$("#"+currentDraggedItem.parentID).remove();$("#dropZoneOuter").replaceWith(a);$("#"+currentDraggedItem.parentID.split("_")[1]+"_collapsible").collapsible({accordion:!1});$("#"+currentDraggedItem.ID).show();currentHoverOver=null;activateHighlightListElement(currentDraggedItem.ID)}function handleDragEnd(a){$("#dropZoneOuter").hide(0,function(){$("#"+currentDraggedItem.ID).show(0)})}
function allowDrop(a){a.preventDefault()}function resetCurentDraggedItem(){return ret={parentID:"null",ID:"null",name:"null"}}function activateHighlightListElement(a){$("#"+a).mouseover(function(){highlightElement(this.id)}).mouseout(function(){resetFromHighlight()})}function activateHighlightList(){$(".highlight-list").mouseover(function(){highlightElement(this.id)}).mouseout(function(){resetFromHighlight()})}
function highlightElement(a){$(".highlight-list").each(function(b){b=$(this).attr("id");b===a?($("#"+b).css("box-shadow","3px 3px 15px #666"),$("#"+b).css("border-color","#C76C0C"),$("#"+b).css("background","#C76C0C"),$("#"+b).css("color","#fff"),$("#"+b).css("cursor","cursor"),$("#"+b).css("filter","alpha(opacity=100)"),$("#"+b).css("opacity","1")):($("#"+b).css("box-shadow",""),$("#"+b).css("border-color",""),$("#"+b).css("background",""),$("#"+b).css("color",""),$("#"+b).css("cursor",""),$("#"+
b).css("filter",""),$("#"+b).css("opacity",""),$("#"+b).css("filter","alpha(opacity=45)"),$("#"+b).css("opacity","0.45"),$("#"+b).css("-webkit-transition","opacity .25s ease-in-out"),$("#"+b).css("-moz-transition","opacity .25s ease-in-out"),$("#"+b).css("-ms-transition","opacity .25s ease-in-out"),$("#"+b).css("-o-transition","opacity .25s ease-in-out"),$("#"+b).css("transition","opacity .25s ease-in-out"))})}
function resetFromHighlight(a){$(".highlight-list").each(function(b){b=$(this).attr("id");b!==$(".highlight-list.active").attr("id")&&b!==a&&($("#"+b).css("box-shadow",""),$("#"+b).css("border-color",""),$("#"+b).css("background",""),$("#"+b).css("color",""),$("#"+b).css("cursor",""),$("#"+b).css("filter",""),$("#"+b).css("opacity",""),$("#"+b).css("filter",""),$("#"+b).css("-webkit-transition",""),$("#"+b).css("-moz-transition",""),$("#"+b).css("-ms-transition",""),$("#"+b).css("-o-transition",""),
$("#"+b).css("transition",""))})}var contextMenu={};function changeCSSinMenu(a,b,c,d){console.log("Inside change CSS");"#pagecontainers"==a?$(a).css(c,d):b.$trigger.parent().siblings(a).css(c,d)}function bringEleToFront(a){var b=0;$("#pagecontainers").children("div").each(function(){var a=$(this).css("zIndex");a>b&&(b=a)});b++;console.log("Set zIndex to ",b);a.css("zIndex",b)}var primary_colour="rgba(255,255,255,1.0)",secondary_colour="rgba(255,255,255,1.0)";
$("#ColourPicker1").spectrum({color:primary_colour,change:function(a){primary_colour=a.toRgbString();$("#ColourPicker1").css("background-color",primary_colour)}});$("#ColourPicker2").spectrum({color:secondary_colour,change:function(a){secondary_colour=a.toRgbString();$("#ColourPicker2").css("background-color",secondary_colour)}});
function generateTemplateCallback(a,b){return function(c,d){if("Load"==d.$selected.parent().siblings("span").html()){console.log("Loading: "+c);var e=d.$trigger.parent().parent().children(a),f=e.html();e[0].outerHTML=b[c].savedhtml;d.$trigger.parent().parent().children(a).html(f)}else"Delete"==d.$selected.parent().siblings("span").html()&&(console.log("Delete: "+c),delete b[c])}}
function loadTemplateMenuObj(){$.each(project_project.template_menus.text_template_menu_list,function(){this.callback=generateTemplateCallback(".editdiv",project_project.template_menus.text_template_menu_list)});$.each(project_project.template_menus.decision_template_menu_list,function(){this.callback=generateTemplateCallback(".editdiv",project_project.template_menus.decision_template_menu_list)});$.each(project_project.template_menus.image_template_menu_list,function(){this.callback=generateTemplateCallback(".editdiv",
project_project.template_menus.image_template_menu_list)});$.each(project_project.template_menus.video_template_menu_list,function(){this.callback=generateTemplateCallback(".editdiv",project_project.template_menus.video_template_menu_list)});$.each(project_project.template_menus.page_template_menu_list,function(){this.callback=generateTemplateCallback(".editdiv",project_project.template_menus.page_template_menu_list)})}
function templateMenuObj(){this.text_template_menu_list={};this.decision_template_menu_list={};this.image_template_menu_list={};this.video_template_menu_list={};this.page_template_menu_list={}}
$.contextMenu.types.color=function(a,b,c){$("<span>"+a.customName+'<ul><li class = "black"></li><li class = "gray"></li><li class = "white"></li><li class = "primary" style="background-color: '+primary_colour+';"></li><li class = "secondary" style="background-color: '+secondary_colour+';"></li>').appendTo(this).on("click","li",function(){var b=a.className.split(" ")[1];changeCSSinMenu(b,c,a.className.split(" ")[0],$(this).css("background-color"));c.$menu.trigger("contextmenu:hide")});this.addClass("color").on("contextmenu:focus",
function(a){}).on("contextmenu:blur",function(a){}).on("keydown",function(a){})};
function generateContextMenu(a,b){if("text"==a||"output"==a||"img"==a||"vid"==a)var c=".editdiv";else"decision"==a?c=".editdec":"page"==a&&(c="#pagecontainers");if("text"==a||"decision"==a||"output"==a)return{items:{font:{name:"Font",items:{Alignment:{name:"Alignment",type:"select",options:{left:"left",right:"right",Center:"Center",Justify:"Justify"}},fontfamily:{name:"Style",type:"select",options:{'"Courier New", Courier, monospace':"Courier New",'"Lucida Console", Monaco, monospace':"Lucinda",'"Times New Roman", Times, serif':"Times New Roman",
'"Arial", Helvetica, sans-serif':"Arial","Tahoma, Geneva, sans-serif":"Tahoma",'"Comic Sans MS", cursive, sans-serif':"Comic Sans"}},"font-size":{name:"Size",callback:function(a,b){var f=b.$trigger.parent().siblings(c);myModal.prompt("Set font size","Between 1 and 40",[{name:"Font-size","default":f.css("font-size"),min:"1",max:"40",type:"number"}],function(a){f.css("font-size",a[0])},function(a){return 40>=a[0]&&1<=a[0]?!0:"Ensure number is between 1 and 40"})}},"font-color":{type:"color",customName:"Font Colour",
className:"color "+c}}},background:{name:"Background",items:{Colour:{type:"color",customName:"Background Colour",className:"background-color "+c},Opacity:{name:"Opacity",callback:function(a,b){var f=b.$trigger.parent().siblings(c),g=f.css("background-color"),g=g.match(/rgba/)?g.replace(/^.*,(.+)\)/,"$1"):1;myModal.prompt("Set Opacity","Between 0 and 100",[{name:"Opacity","default":100*g,min:"0",max:"100",type:"number"}],function(a){a=parseFloat(a[0]);if(100>=a&&0<=a){a/=100;var b=f.css("background-color"),
b=-1==b.indexOf("a")?b.replace(")",", "+a+")").replace("rgb","rgba"):b.substr(0,b.lastIndexOf(",")).concat(", "+a+")");console.log("Current colour: ",b);f.css("background-color",b)}return!1},function(a){return 100>=a[0]&&0<=a[0]?!0:"Ensure number is between 0 and 100"})}}}},border:border_menu_entry(c),position:zIndex_menu_entry(),sep2:"---------",clone:{name:"Clone",callback:function(a,b){}},template:{name:"Templates",items:{save:{name:"Save As",callback:function(a,e){var f=e.$trigger.parent().parent().children(c)[0].outerHTML;
myModal.prompt("Create Container Template","Saves the style of this container (e.g. background colour), allowing you to load them into other containers",[{name:"Template","default":"",type:"text"}],function(a){a=a[0];b[a]={name:a,savedhtml:f,callback:generateTemplateCallback(c,b)}},function(a){return""==a[0]?"Can't be an empty name":"Default"==a[0]?"Can't override Default":void 0!==b[a[0]]?"A template with that name already exists":!0})}},load:{name:"Load",items:b},"delete":{name:"Delete",items:b}}},
"delete":{name:"Delete",icon:"delete",callback:function(b,c){if(confirm("Are you sure you want to delete this container?")){var f=c.$trigger.siblings(".handle").attr("id").split(a)[1];removeContainer(a,f)}}}},events:{show:function(a){$.contextMenu.setInputValues(a,this.data())},hide:function(a){$.contextMenu.getInputValues(a,this.data());changeCSSinMenu(c,a,"border-style",this.data().Style);changeCSSinMenu(c,a,"text-align",this.data().Alignment);changeCSSinMenu(c,a,"font-family",this.data().fontfamily)}}};
if("img"==a)return{items:{border:border_menu_entry(c),position:zIndex_menu_entry(),sep3:"---------",URL:{name:"Change URL",callback:function(b,e){var f=e.$trigger.parent().siblings(c);myModal.prompt("Change URL","",[{name:"Enter image url","default":"http://",type:"text"}],function(a){var b=a[0];$.ajax({url:b,success:function(a){a=f.parent();f.remove();a.append(html_string)},error:function(a){alert("URL: "+b+" does not exist")}})},function(b){return checkImageURL(b[0],a)?!0:b[0]+"not a valid URL"})}},
"delete":{name:"Delete",icon:"delete",callback:function(b,c){if(confirm("Are you sure you want to delete this container?")){var f=c.$trigger.siblings(".handle").attr("id").split(a)[1];removeContainer(a,f)}}}},events:{show:function(a){$.contextMenu.setInputValues(a,this.data())},hide:function(a){$.contextMenu.getInputValues(a,this.data());changeCSSinMenu(c,a,"border-style",this.data().Style)}}};if("vid"==a)return{items:{border:border_menu_entry(c),position:zIndex_menu_entry(),sep3:"---------",URL:{name:"Change URL",
callback:function(b,e){var f=e.$trigger.parent().siblings(c);myModal.prompt("Change URL","",[{name:"Enter image url","default":"http://",type:"text"}],function(b){var c=b[0];(html_string=checkImageURL(c,a))&&$.ajax({url:c,success:function(a){a=f.parent();f.remove();a.append(html_string)},error:function(a){alert("URL: "+c+" does not exist")}})},function(b){return checkImageURL(b[0],a)?!0:b[0]+"not a valid URL"})}},"delete":{name:"Delete",icon:"delete",callback:function(b,c){if(confirm("Are you sure you want to delete this container?")){var f=
c.$trigger.siblings(".handle").attr("id").split(a)[1];removeContainer(a,f)}}}},events:{show:function(a){$.contextMenu.setInputValues(a,this.data())},hide:function(a){$.contextMenu.getInputValues(a,this.data());changeCSSinMenu(c,a,"border-style",this.data().Style)}}};if("page"==a)return{items:{border:border_menu_entry(c),background:{type:"color",customName:"Background Colour",className:"background-color "+c}},events:{show:function(a){$.contextMenu.setInputValues(a,this.data())},hide:function(a){$.contextMenu.getInputValues(a,
this.data());$(c).css("border-style",this.data().Style)}}}}
function zIndex_menu_entry(){return{name:"Position",items:{Front:{name:"Bring to Front",callback:function(a,b){var c=0;$("#pagecontainers").children("div").each(function(){var a=$(this).css("zIndex");a>c&&(c=a)});c++;console.log("Set zIndex to ",c);b.$trigger.parent().parent().css("zIndex",c)}},Back:{name:"Send to Back",callback:function(a,b){var c=1E4;$("#pagecontainers").children("div").each(function(){var a=$(this).css("zIndex");a<c&&(c=a)});c--;0>c&&(c=0);console.log("Set zIndex to ",c);b.$trigger.parent().parent().css("zIndex",
c)}}}}}
function border_menu_entry(a){return{name:"Border",items:{Style:{name:"Style",type:"select",options:{none:"None",solid:"Solid","double":"Double",dashed:"Dashed",dotted:"Dotted",outset:"Outset",ridge:"Ridge"}},Colour:{type:"color",customName:"Colour",className:"border-color "+a},Corners:{name:"Rounded Corners",callback:function(b,c){var d=c.$trigger.parent().siblings(a);"#pagecontainers"==a&&(d=$(a));myModal.prompt("Corner rounding","Square is 0, the higher the rounder. Results may vary.",[{name:"Rounding pixels","default":parseInt(d.css("border-radius")),
min:"0",max:"1000",type:"number"}],function(a){d.css("border-radius",a[0]+"px")},function(a){a=a[0];return 1E3>=a&&0<=a?!0:"Ensure border radius greater than 0 and less than 1000"})}},Thickness:{name:"Border Width",callback:function(b,c){var d=c.$trigger.parent().siblings(a);"#pagecontainers"==a&&(d=$(a));myModal.prompt("Border Width","Any value between 1 and 40. To hide set border style to 'none'",[{name:"Thickness pixels","default":parseInt(d.css("border-width")),min:"1",max:"40",type:"number"}],
function(a){d.css("border-width",a[0]+"px")},function(a){a=a[0];return 40>=a&&0<=a?!0:"Ensure border width greater than 1 and less than 40"})}}}}}
$(function(){$.contextMenu({selector:".textmenu",trigger:"left",build:function(a,b){console.log("Triggered text menu context menu");return generateContextMenu("text",project_project.template_menus.text_template_menu_list)}});$.contextMenu({selector:".decmenu",trigger:"left",build:function(a,b){return generateContextMenu("decision",project_project.template_menus.decision_template_menu_list)}});$.contextMenu({selector:".controlmenu",trigger:"left",build:function(a,b){return generateContextMenu("text",
project_project.template_menus.text_template_menu_list)}});$.contextMenu({selector:".imgmenu",trigger:"left",build:function(a,b){return generateContextMenu("img",project_project.template_menus.image_template_menu_list)}});$.contextMenu({selector:".vidmenu",trigger:"left",build:function(a,b){return generateContextMenu("vid",project_project.template_menus.video_template_menu_list)}});$.contextMenu({selector:".pagemenu",trigger:"left",build:function(a,b){return generateContextMenu("page")}});$.contextMenu({selector:"#addevent",
trigger:"left",build:function(a,b){return{items:{Audio:{name:"Audio",items:project_project.audio.getAssetAsMenu()}}}}})});
$.contextMenu({selector:".swap-controlmenu",trigger:"left",build:function(a){a={items:{}};a.items.maker={name:"Game Maker Output",callback:function(a,c){$(".output-container").hasClass("maker")||($(".output-container").removeClass("player"),$(".output-container").addClass("maker"))}};a.items.player={name:"Game Player Output",callback:function(a,c){$(".output-container").hasClass("player")||($(".output-container").removeClass("maker"),$(".output-container").addClass("player"))}};return a}});
var dragDrop={};grid_snapping_mode=!1;var grid_targets=interact.createSnapGrid({x:10,y:10,range:10,offset:{x:-2,y:2}});function initSnapOptions(){return grid_snapping_mode?{targets:[grid_targets],relativePoints:[{x:1,y:1}],endOnly:!1}:{targets:[],relativePoints:[{x:1,y:1}],endOnly:!1}}var snap_options=initSnapOptions();
function setInteractions(){interact(".drag-element:not([locked])").draggable({snap:snap_options,inertia:!1,restrict:{restriction:"parent",endOnly:!1,elementRect:{top:0,left:0,bottom:1,right:1}},onstart:function(a){console.log("Started dragging")},onmove:dragMoveListener,onend:function(a){console.log(a)}}).allowFrom(".handle");interact(".resize-element").resizable({snap:snap_options,edges:{left:!1,right:!0,bottom:!0,top:!1},onmove:resizeMoveListener});interact(".resize-child").resizable({snap:snap_options,
edges:{left:!1,right:!0,bottom:!0,top:!1},onmove:resizeChildMoveListener})}setInteractions();function toggleGridMode(){(grid_snapping_mode=!grid_snapping_mode)?$(".gridmode").html("Grid: Enabled"):$(".gridmode").html("Grid: Disabled");$(".gridmode").toggleClass("activebutton");snap_options=initSnapOptions();setInteractions()}
function resizeMoveListener(a){var b=$("#pagecontainers")[0],c=b.getBoundingClientRect().width/b.offsetWidth,d=b.getBoundingClientRect().height/b.offsetHeight,b=a.target,c=a.rect.width/c;a=a.rect.height/d;offset_left=b.parentNode.getAttribute("data-x");offset_top=b.parentNode.getAttribute("data-y");c=checkBounds(offset_left,c,$("#pagecontainers").width());a=checkBounds(offset_top,a,$("#pagecontainers").height());b.style.width=c+"px";b.style.height=a+"px"}
function resizeChildMoveListener(a){var b=$("#pagecontainers")[0],c=b.getBoundingClientRect().width/b.offsetWidth,d=b.getBoundingClientRect().height/b.offsetHeight,b=a.target,c=a.rect.width/c;a=a.rect.height/d;offset_left=b.parentNode.getAttribute("data-x");offset_top=b.parentNode.getAttribute("data-y");c=checkBounds(offset_left,c,$("#pagecontainers").width());a=checkBounds(offset_top,a,$("#pagecontainers").height());b.style.width=c+"px";b.style.height=a+"px";b.firstChild.width=c-4-2*parseFloat(getComputedStyle(b).getPropertyValue("border-left-width"));
b.firstChild.height=a-8-2*parseFloat(getComputedStyle(b).getPropertyValue("border-top-width"))}function checkBounds(a,b,c){a=parseFloat(a)||0;a+b>c&&(b=c-a);return b}
function dragMoveListener(a){var b=$("#pagecontainers")[0],c=b.getBoundingClientRect().width/b.offsetWidth,d=b.getBoundingClientRect().height/b.offsetHeight,b=a.target,c=(parseFloat(b.getAttribute("data-x"))||0)+a.dx/c;a=(parseFloat(b.getAttribute("data-y"))||0)+a.dy/d;b.style.webkitTransform=b.style.transform="translate("+c+"px, "+a+"px)";b.setAttribute("data-x",c);b.setAttribute("data-y",a)}window.dragMoveListener=dragMoveListener;var pageOverlay={},show_handles=!0;
function updatePageStyle(a){openEditPageOverlay(a);closeOverlay(a)}function toggleHandles(){show_handles=!show_handles;$(".handlemode").toggleClass("activebutton");show_handles?($(".handlecontainer").show(),$(".handlemode").html("Handles: Shown")):($(".handlecontainer").hide(),$(".handlemode").html("Handles: Hidden"))}
function addDecisionContainer(a,b,c,d){b=genPageCenterHTML(300,220,a.data("decisioncontainers").length);b="<div class = 'decision-container drag-element' style='position:absolute; z-index: "+bringContainerToFront("decision")+"; "+b+"'>";b+="<div class = 'editdec decisionbutton drag-element resize-element' contenteditable=true>"+escapeHtml(c)+"</div>";b+="</div>";c=a.data("decisioncontainers");c.push({name:d,html:b});a.data("decisioncontainers",c)}
function addOutputContainer(){if($("#pagecontainers div.output-container:last").length)alert("You may only have one control output container per page");else{var a="<div class='output-container player drag-element' style='position:absolute; "+genPageCenterHTML(300,220)+"'>",a=htmlToElements(a+"<div class='editdiv resize-element' contenteditable=false ></div></div>");$("#pagecontainers").append(a);$("#pagecontainers div.output-container:last").prepend(genHandleHTML("output",0));bringContainerToFront($("pagecontainers div.output-container:last"));
show_handles||$(".handlecontainer").hide();bindHandleSelection()}}
function addTextContainer(){var a="<div class='text-container drag-element' style='position:absolute; "+genPageCenterHTML(300,220)+"'>",a=a+"<div class='editdiv resize-element' contenteditable=true ></div></div>",b=$(".text-container").length,a=htmlToElements(a);$("#pagecontainers").append(a);$("#pagecontainers div.text-container:last").prepend(genHandleHTML("text",b+1));bringContainerToFront($("pagecontainers div.text-container:last"));$("#pagecontainers div.text-container:last .editdiv").trigger("focus");
show_handles||$(".handlecontainer").hide();bindHandleSelection()}
function addImageContainer(){var a;myModal.prompt("Add image","Directly link a jpeg|jpg|gif|png",[{name:"Image URL","default":"http://i.imgur.com/ZeUPvbP.jpg",type:"text"}],function(b){if(myModal.confirm){var c=b[0];b=genPageCenterHTML(300,220);null!=c&&(a="<div class='img-container drag-element' style='position:absolute; "+b+"'>",b=checkImageURL(c,"img"))&&(a+=b,a+="</div>",$.ajax({url:c,success:function(b){b=$(".img-container").length;var c=htmlToElements(a);$("#pagecontainers").append(c);$("#pagecontainers div.img-container:last").prepend(genHandleHTML("img",
b+1));bringContainerToFront($("pagecontainers div.img-container:last"));show_handles||$(".handlecontainer").hide();bindHandleSelection()},error:function(a){alert("URL: "+c+" does not exist")}}))}})}
function addVideoContainer(){var a;myModal.prompt("Add Video","Supports links to .webm, .mp4, .gifv and (soon) youtube",[{name:"Video URL","default":"https://www.youtube.com/watch?v=4vKmEmY8ZD8",type:"text"}],function(b){if(myModal.confirm){var c=b[0];b=genPageCenterHTML(300,220);null!=c&&(a="<div class='vid-container drag-element' style='position:absolute; "+b+"'>",b=checkImageURL(c,"vid"),console.log("Valid: ",b),b&&(a+=b,a+="</div>",$.ajax({url:c,success:function(b){b=$(".vid-container").length;
var c=htmlToElements(a);$("#pagecontainers").append(c);$("#pagecontainers div.vid-container:last").prepend(genHandleHTML("vid",b+1));bringContainerToFront($("pagecontainers div.vid-container:last"));show_handles||$(".handlecontainer").hide();bindHandleSelection()},error:function(a){alert("URL: "+c+" does not exist")}})))}})}
function checkImageURL(a,b){var c="",d=/^(?:https?:\/\/)?(?:www\.)?(?:youtu\.be\/|youtube\.com\/(?:embed\/|v\/|watch\?v=|watch\?.+&v=))((\w|-){11})(?:\S+)?$/;if(""==a)return alert("Not a valid url"),!1;if(null!=a.match(/\.(jpeg|jpg|gif|png)$/)&&"img"==b)c+="<img class='editdiv resize-element' src="+a+"></img>";else if(null!=a.match(/\.(webm)$/)&&"vid"==b)c=c+"<video preload='auto' autoplay='autoplay' loop='loop' class='editdiv resize-element'>"+('<source src= "'+a+"\"type='video/webm'></source>")+
"</video>";else{if(a.match(d)&&RegExp.$1){var d=a.match(d)?RegExp.$1:!1,e="youtube_video_"+d;if(0!==$(e).length)return;var c="<div class='vid-container drag-element' style='position:absolute; "+genPageCenterHTML(300,220)+"'>",c=c+"<div class='editdiv resize-child'>",c=c+("<div id='"+e+"'></div></div></div>"),f=$(".vid-container").length,c=htmlToElements(c);$("#pagecontainers").append(c);$("#pagecontainers div.vid-container:last").prepend(genHandleHTML("vid",f+1));bringContainerToFront($("pagecontainers div.vid-container:last"));
show_handles||$(".handlecontainer").hide();bindHandleSelection();console.log("videoID:",d);new YT.Player(e,{origin:"https://www.youtube.com",height:"220",width:"300",playerVars:{autoplay:1,controls:1},videoId:d,events:{onError:function(a){this.destroy()}}});$(e).addClass("resize-element");return!1}if(null!=a.match(/\.(gifv|mp4)$/)&&"vid"==b)d=a.lastIndexOf(".gifv"),-1!=d&&(a=a.substr(0,d)+".mp4",console.log("Regexed to: ",a)),c+="<video preload='auto' autoplay='autoplay' loop='loop' class='editdiv resize-element'>",
c+='<source src= "'+a+"\"type='video/mp4'></source>",c+="</video>";else return alert("Not a valid url"),!1}return c}
function genHandleHTML(a,b){var c;c="<div class = 'handlecontainer'>";if("img"==a)c=c+'<a class="btn-floating waves-effect waves-light green lefticon"><i class="fa fa-picture-o"></i></a>'+("<div id = 'img"+b+"'class = 'handle img-handle'>Image")+"</div>",c+='<a class="imgmenu btn-floating waves-effect waves-light red righticon"><i class="material-icons">settings</i></a>';else if("vid"==a)c+='<a class="btn-floating waves-effect waves-light blue-grey darken-4 lefticon"><i class="fa fa-film"></i></a>',
c+="<div id = 'vid"+b+"'class = 'handle vid-handle'>Video",c+="</div>",c+='<a class="vidmenu btn-floating waves-effect waves-light red righticon"><i class="material-icons">settings</i></a>';else if("text"==a)c+='<a class="btn-floating waves-effect waves-light grey lefticon"><i class="material-icons">comment</i></a>',c+="<div id = 'text"+b+"'class = 'handle text-handle'>Text",c+="</div>",c+='<a class="textmenu btn-floating waves-effect waves-light red righticon"><i class="material-icons">settings</i></a>';
else if("decision"==a)c+='<a class="btn-floating waves-effect waves-light blue lighten-3 lefticon">'+b+"</a>",c+="<div id = 'decision"+b+"'class = 'handle link-handle'>Decision",c+="</div>",c+='<a class="decmenu btn-floating waves-effect waves-light red righticon"><i class="material-icons">settings</i></a>';else if("output"==a)c+='<a class="btn-floating waves-effect waves-light indigo lighten-1 lefticon swap-controlmenu"><i class="fa fa-terminal"></i></a>',c+="<div id = 'output"+b+"'class = 'handle control-handle'>Output",
c+="</div>",c+='<a class="controlmenu btn-floating waves-effect waves-light red righticon"><i class="material-icons">settings</i></a>';else return console.log("Unknown container type when generating handle for HTML"),null;return c+"</div>"}
function genPageCenterHTML(a,b,c){a=(parseFloat(project_project.resolution.x)-a)/2;b=(parseFloat(project_project.resolution.y)-b)/2;0<=c&&(b+=30*c);b>project_project.resolution.y&&(b=project_project.resolution.y);return"transform: translate("+a+"px, "+b+"px);' data-x='"+a+"' data-y='"+b}
function removeContainer(a,b){if("decision"==a){var c=cy.$(":selected")[0];closeOverlay(c);console.log("Removing link ",b," from cytoscape");outgoingEdges=c.outgoers().edges();for(var d=0,e=!1;d<outgoingEdges.size()&&!e;)console.log("Increment to ",d),outgoingEdges[d].data("name")==b&&(console.log("Removing link ",b," from cytoscape"),e=!0,cleanup_edge_labels(outgoingEdges[d])),d++;openEditPageOverlay(c)}else $("#"+a+b).parent().parent().remove()}
function bindHandleSelection(){$(".handle").last().on("mousedown touch",function(a){$(this).siblings().trigger("focus");bringContainerToFront($(this).parent().parent());console.log("trigger handle")})}function bringContainerToFront(a){var b=50;$("#pagecontainers").children("div").each(function(){var a=$(this).css("zIndex");a>b&&(b=a)});b++;if("decision"==a)return b;console.log("Set zIndex to ",b);a.css("zIndex",b)}
function populatePageOverlay(a){console.log("Populate page "+a.data("name"));$("#pagename").html("Design Page: "+a.data("name"));$("#pagecontainers").append('<a style="float:right" class="pagemenu btn-floating waves-effect waves-light gray"><i class="material-icons">settings</i></a>');var b=a.data("pagestyle");$("#pagecontainers").attr("style",b);b=a.data("outputcontainer");$("#pagecontainers").append(b);$("#pagecontainers div.output-container:last").prepend(genHandleHTML("output",0));for(var c=a.data("textcontainers"),
b=0;b<c.length;b++)$("#pagecontainers").append(c[b].html),$("#pagecontainers div.text-container:last").prepend(genHandleHTML("text",c[b].name));c=a.data("imgcontainers");for(b=0;b<c.length;b++)$("#pagecontainers").append(c[b].html),$("#pagecontainers div.img-container:last").prepend(genHandleHTML("img",c[b].name));c=a.data("vidcontainers");for(b=0;b<c.length;b++)$("#pagecontainers").append(c[b].html),$("#pagecontainers div.vid-container:last").prepend(genHandleHTML("vid",c[b].name));$("#eventspane").append('<span class="eventspanetitle eventname" style="text-align:center; font-size: 16px;">Asset</span><span class="eventspanetitle eventtype" style="text-align:center; font-size: 16px;">Event</span><span class="eventspanetitle eventtrigger" style="text-align:center; font-size: 16px;">Time</span>');
b=a.data("events");for(c=0;c<b.length;c++)project_project.audio.getAsset(b[c].id)&&project_project.audio.getAsset(b[c].id).addEvent(),$(".eventtrigger input").last().val(b[c].trigger),$(".eventtype select").last().val(b[c].action),$(".eventtype .setting").last().val(b[c].setting),"Volume"==b[c].action&&$(".eventtype .setting").last().show(),$(".eventscontainer").last().find("select").material_select();outgoingEdges=a.outgoers().edges();for(var d=a.data("decisioncontainers"),c=0;c<outgoingEdges.size();c++){for(var e=
!1,b=0;b<d.length;b++)outgoingEdges[c].data("name")==d[b].name&&(e=!0);e||addDecisionContainer(a,c,outgoingEdges.eq(c).data("text"),outgoingEdges[c].data("name"))}for(b=0;b<d.length;b++){e=!1;for(c=0;c<outgoingEdges.size();c++)d[b].name==outgoingEdges[c].data("name")&&($("#pagecontainers").append(d[b].html),$("#pagecontainers div.decision-container:last").prepend(genHandleHTML("decision",d[b].name)),e=!0);e||d.splice(b,1)}show_handles||$(".handle").hide();$(".handle").on("mousedown touch",function(a){$(this).siblings().trigger("focus");
bringContainerToFront($(this).parent().parent());console.log("trigger handle")})}
function savePage(a){$("#pagecontainers .handlecontainer").remove();a.data("textcontainers",[]);a.data("imgcontainers",[]);a.data("vidcontainers",[]);a.data("events",[]);a.data("pagestyle",$("#pagecontainers").attr("style"));$("#pagecontainers .output-container").length&&a.data("outputcontainer",$(".output-container")[0].outerHTML);var b=[];$("#pagecontainers").children("div[class^='text-container']").each(function(a){var c=this.outerHTML;console.log("Updating HTML for ",a);b.push({name:a+1,html:c})});
a.data("textcontainers",b);var c=[];$("#pagecontainers").children("div[class^='img-container']").each(function(a){var b=this.outerHTML;console.log("Save HTML for img ",a);c.push({name:a+1,html:b})});a.data("imgcontainers",c);var d=[];$("#pagecontainers").children("div[class^='vid-container']").each(function(a){d.push({name:a+1,html:this.outerHTML})});a.data("vidcontainers",d);$("#pagecontainers").children("div[class^='decision-container']").each(function(b){var c=this.outerHTML;a.data("decisioncontainers")[b].html=
c});var e=[];$("#eventspane").children(".eventscontainer").each(function(a){var b=$(this).children(".eventname"),c=$(this).attr("class").split(" ")[0];a=b.nextAll(".eventtype:first");var d=a.nextAll(".eventtrigger:first"),k=$(this).attr("id"),b={eventtype:c,id:k,name:b.html(),action:a.find("div input").val(),setting:a.find(".setting").val(),trigger:d.find("input").val()};a.material_select("destroy");e.push(b)});e.sort(function(a,b){return parseFloat(a.trigger)-parseFloat(b.trigger)});a.data("events",
e);a.data("eventspane",$("#eventspane").html());$("#pagecontainers").html("");$("#eventspane").html("");selected_event=null}function resizePageContainerDiv(){if($("#page-modal").hasClass("open")){console.log("Resizing page container div");var a=$(".screenwrapper").width(),b=$(".screenwrapper").height(),c=$("#pagecontainers").width(),d=$("#pagecontainers").height(),a=Math.min(a/c,b/d);$("#pagecontainers").css({transform:"scale("+a+")"})}}
var layouts={},cose_layout={name:"cose",ready:function(){},stop:function(){},animate:!0,animationThreshold:250,refresh:1,fit:!0,padding:30,boundingBox:void 0,componentSpacing:100,nodeRepulsion:function(a){return 4E5},nodeOverlap:10,idealEdgeLength:function(a){return 10},edgeElasticity:function(a){return 100},nestingFactor:5,gravity:80,numIter:1E3,initialTemp:200,coolingFactor:.95,minTemp:1,useMultitasking:!0},concentric_layout={name:"concentric",fit:!0,padding:30,startAngle:1.5*Math.PI,sweep:void 0,
clockwise:!0,equidistant:!0,minNodeSpacing:30,boundingBox:void 0,avoidOverlap:!0,height:void 0,width:void 0,concentric:function(a){return a.degree()},levelWidth:function(a){return a.maxDegree()/4},animate:!0,animationDuration:500,animationEasing:void 0,ready:void 0,stop:void 0},grid_layout={name:"grid",fit:!0,padding:30,boundingBox:void 0,avoidOverlap:!0,avoidOverlapPadding:10,condense:!1,rows:void 0,cols:void 0,position:function(a){},sort:void 0,animate:!0,animationDuration:500,animationEasing:void 0,
ready:void 0,stop:void 0},cose_bilkent={name:"cose-bilkent",ready:function(){},stop:function(){},fit:!0,padding:10,randomize:!0,nodeRepulsion:4500,idealEdgeLength:120,edgeElasticity:.45,nestingFactor:.1,gravity:.25,numIter:2500,tile:!0,animate:"end",tilingPaddingVertical:10,tilingPaddingHorizontal:10,gravityRangeCompound:1.5,gravityCompound:4,gravityRange:3.8},breadth_first_layout={name:"breadthfirst",fit:!0,directed:!0,padding:30,circle:!1,spacingFactor:1.75,boundingBox:void 0,avoidOverlap:!0,roots:!1,
maximalAdjustments:0,animate:!0,animationDuration:500,animationEasing:void 0,ready:void 0,stop:void 0};function style_end_nodes(){cy.elements(".leaf").removeClass("leaf");cy.$("node").successors().leaves(".page").addClass("leaf")}
function cleanup_node_labels(a){var b=!1;a.hasClass("start")&&(b=!0);cy.remove(a);a=0;for(a;a<cy.nodes(".page, .control").size();a++){var c=cy.nodes(".page, .control")[a];name=parseInt(c.data("name"));isNaN(name)?console.log("Not a number"):(c.style("label",a+1),c.data("name",a+1))}b&&(b=cy.$(".page").first(),b.addClass("start"),b.removeClass("leaf"))}
function cleanup_edge_labels(a){var b=a.source();if(b.hasClass("page"))for(var c=0;c<b.data("decisioncontainers").length;c++)if(b.data("decisioncontainers")[c].name==a.data("name")){b.data("decisioncontainers").splice(c,1);break}cy.remove(a);c=0;a=b.edgesTo("*");updatePageStyle(b);for(c;c<a.size();c++){var d=String.fromCharCode("A".charCodeAt()+c);a[c].style("label",d);a[c].data("name",d);b.hasClass("page")&&(b.data("decisioncontainers")[c].name=d)}}
function layout_driver(a){if("none"!=a){var b=null;"Tree"==a?b=breadth_first_layout:"Grid"==a?b=grid_layout:"Circle"==a?b=concentric_layout:"Spread"==a?b=cose_layout:"Smart Spread"==a&&(b=cose_bilkent);null!==b?change_layout(b):console.log("No layout selected")}}function change_layout(a){"breadthfirst"==a.name&&(console.log("Set root"),a.roots=cy.$(".start"));cy.layout(a)}var ui={};
function setStart(){cy.$(".start").removeClass("start");cy.$(":selected")[0].addClass("start");cy.$(":selected")[0].removeClass("leaf")}function removeParent(){cy.$(":selected")[0].move({parent:null})}
function removeElement(){element=cy.$(":selected");parent=cy.$(":selected").parent();element.empty()||(element.isNode()?(0<element.connectedEdges().size()&&element.connectedEdges().forEach(function(a){a.hasClass("controledge")&&removeEdgeFromPriorityList(a)}),element.hasClass("jump")||element.hasClass("jumpend")?cy.remove(element):cleanup_node_labels(element)):element.isEdge()&&(element.hasClass("controledge")&&removeEdgeFromPriorityList(element),cleanup_edge_labels(element),style_end_nodes()),parent.empty()||
parent.children().empty()&&parent.remove());$(".editbutton").hide();$(".selectionbutton").hide()}
function createConnection(a){if(current_state==states.CONNECTING&&a.isNode())if(null==source_node)a.hasClass("jumpend")||(source_node=a,source_node.addClass("source_node"),console.log("Source node assigned as node",source_node.data("id")));else if(source_node.data("id")!=a.data("id")){console.log("Creating link from ",source_node.data("id")," to ",a.data("id"));var b="",c=!0;if(a.hasClass("jump"))c=!1;else if(source_node.hasClass("jump"))b+="jumpedge",0!=source_node.edgesTo("*").length&&(c=!1);else if(source_node.hasClass("control")){var d=
source_node.edgesTo("*"),b="fail-edge";d.forEach(function(a){a.hasClass("fail-edge")&&(b="success-edge")});b+=" controledge"}else source_node.hasClass("page")&&(b+="pageedge");c&&(c=String.fromCharCode("A".charCodeAt()+source_node.edgesTo("*").size()),a=cy.add({data:{name:c,source:source_node.data("id"),target:a.data("id"),text:"",conditions:[],outcomes:[]},classes:b,group:"edges"}),a.on("tap",function(a){this.select()}),source_node.hasClass("control")&&(source_node.json().data.priorityList.push(a.json().data.id),
console.log("control nodes defaultFailEdge: "+source_node.json().data.defaultFailEdge),"none"===source_node.json().data.defaultFailEdge&&(console.log("setting initial default fail edge to "+a.json().data.id),source_node.json({data:{defaultFailEdge:a.json().data.id}}),console.log("default fail edge is "+source_node.json().data.defaultFailEdge))),console.log(cy.elements().jsons()));source_node.removeClass("source_node");source_node=null;style_end_nodes()}}
function resizeCanvas(){var a=$(window).width(),b=$(window).height(),c=$("#tabheadings").height()+$(".nav-wrapper").height();$("#cy").css("width",9*a/12-30);$("#cy").css("height",b-c);$("#sidebar").css("height",b-c);console.log("We resized, width: "+a+" height: "+b);cy.resize();resizePageContainerDiv()}$(window).resize(resizeCanvas);
var observer=new MutationObserver(function(a){a.forEach(function(a){(a.oldvalue="block"==a.target.style.display)&&cy.resize()})}),cytabNode=$("#cyTab")[0],observerConfig={attributes:!0,childList:!1,characterData:!1,attributeOldValue:!0,attributeFilter:["style"]};observer.observe(cytabNode,observerConfig);function createModule_playGame(){$("#cyTab").hide();prepareForGame();$("#Play").show()}function createModule_showProject(){$("#Play").hide();wipeGame();$("#cyTab").show()}var pageTemplates={};console.log("enter pageTemplates.js");
var selected_page_template=project_project.project_templates.Default;
function createPageTemplate(){myModal.prompt("Create Page Template","Add a new template when you create a new page node, which contains an exact copy of the contents of this page (other than decisions)",[{name:"Enter name","default":"",type:"text"}],function(a){a=a[0];var b=cy.$(":selected")[0].data();project_project.project_templates[a]=b;$("#pagetemplates").append("<li><a onclick=\"chooseNodeTemplate('"+a+"');\">"+a+"</a></li>")},function(a){return""==a[0]?"Can't be an empty name":"Default"==a[0]?
"Can't override Default":void 0!==project_project.project_templates[a[0]]?"A template with that name already exists":!0})}function chooseNodeTemplate(a){$(".pagemode").addClass("activebutton");current_state=states.NEWPAGE;selected_page_template=project_project.project_templates[a];$(".pagemode").html("Page Node ("+a+")");console.log("Select template: "+a)}var canvasEvents={};console.log("Enter canvasEvents.js");compound_group_num=0;held_node=source_node=null;
cy.on("tapstart","node",function(a){held_node=a.cyTarget});
cy.on("tapend",function(a){if(null!=held_node){console.log("Check for dropping into parents:",cy.$(":parent").length);var b=cy.$(":parent:orphan.expanded");a=a.cyRenderedPosition;testobj={added:!1,parent:"none"};checkCompoundBounds(b,a,testobj);console.log("Finished: ",testobj);testobj.added&&testobj.parent!==held_node.parent().id()&&(console.log("Move ",held_node.id()," into ",testobj.parent),1<cy.$(":selected").length&&(held_node=held_node.union("node:selected:orphan")),held_node.move({parent:testobj.parent}));
held_node=null}});cy.on("taphold",":parent",function(a){parent.children().animated()});
cy.on("tap",":parent:selected",function(a){cy.$(":selected").unselect();this.hasClass("collapsed")?(expand(this),this.descendants().outgoers("edge").removeClass("hidden")):this.hasClass("expanded")&&(this.descendants().each(function(a,c){if(c.parent().hasClass("expanded")){var d=c.position().x,e=c.position().y,d={x:d,y:e};console.log("Save position for: ",c.id()," at: ",d);c.data("displacement",d)}}),collapse(this),this.descendants().outgoers("edge").addClass("hidden"))});
function checkCompoundBounds(a,b,c){a.forEach(function(a){var e=a.renderedBoundingBox();b.x>e.x1&&b.x<e.x2&&b.y>e.y1&&b.y<e.y2&&held_node!==a&&(c.added=!0,c.parent=a.id(),checkCompoundBounds(a.children(":parent.expanded").difference(a),b,c))})}
function expand(a){console.log("Expand:",a.id());a.position();a.hasClass("collapsed")&&(a.descendants().each(function(a,c){c.stop(!1,!0);var d=this.data("displacement").x,e=this.data("displacement").y;console.log(c.id(),"X: ",+d,"Y: ",e);c.animate({position:{x:d,y:e},style:{opacity:1},complete:function(){c.isParent()&&(c.removeClass("collapsed"),c.addClass("expanded"))}},{duration:500});c.removeClass("hidden")}),a.removeClass("collapsed"),a.addClass("expanded"))}
function collapse(a){console.log("Collapse:",a.id());if(!a.animated()){var b=a.position();a.hasClass("expanded")&&(a.descendants().each(function(a,d){d.stop(!1,!0);d.animate({position:{x:b.x,y:b.y},style:{opacity:0},complete:function(){d.addClass("hidden");d.isParent()&&(d.addClass("collapsed"),d.removeClass("expanded"))}},{duration:500})}),a.addClass("collapsed"),a.removeClass("expanded"))}}
cy.on("tap",":selected",function(a){console.log("Tapped on: ",cy.$(":selected").data("name"));current_state===states.CONNECTING&&createConnection(a.cyTarget)});
cy.on("tap",function(a){var b=a.cyTarget;b===cy&&(console.log("touch screen unselect"),cy.$(":selected").unselect(),current_state===states.CONNECTING&&b===cy&&null!==source_node&&(source_node.removeClass("source_node"),source_node=null),current_state===states.NEWPAGE?(console.log("Add a node"),b===cy&&console.log("Really Add a node"+cy.add({data:{name:cy.nodes(".page, .control").size()+1,pagestyle:selected_page_template.pagestyle,outputcontainer:selected_page_template.outputcontainer,imgcontainers:selected_page_template.imgcontainers,
vidcontainers:selected_page_template.vidcontainers,textcontainers:selected_page_template.textcontainers,decisioncontainers:[],events:[],eventspane:'<div class= "eventscontainer"><span class="eventspanetitle eventname" style="text-align:center; font-size: 16px;">Asset</span><span class="eventspanetitle eventtype" style="text-align:center; font-size: 16px;">Event</span><span class="eventspanetitle eventtrigger" style="text-align:center; font-size: 16px;">Trigger</span></div>'},classes:"page",group:"nodes",
renderedPosition:a.cyRenderedPosition}).data()),1===cy.elements(".page").size()&&cy.$(".page").first().addClass("start")):current_state===states.NEWCONTROL?b===cy&&cy.add({data:{name:cy.nodes(".page, .control").size()+1,priorityList:[],defaultFailEdge:"none"},classes:"control",group:"nodes",renderedPosition:a.cyRenderedPosition}):current_state===states.NEWJUMP?b===cy&&cy.add({data:{name:"Jump "+(cy.nodes(".jump").size()+1),triggerType:null,button:null,conditions:[],origin:null,repeat:"Repeatedly"},
classes:"jump",group:"nodes",renderedPosition:a.cyRenderedPosition}):current_state===states.NEWJUMPEND?b===cy&&cy.add({data:{trigger:"none"},classes:"jumpend",group:"nodes",renderedPosition:a.cyRenderedPosition}):current_state===states.NEWFIGHT?b===cy&&createFight(a):current_state===states.NEWSTORE?b===cy&&cy.add({data:{name:"Group"},classes:"expanded",group:"nodes",renderedPosition:a.cyRenderedPosition},{}):current_state===states.NEWEMPTY&&b===cy&&(empty_collection=cy.add([{data:{id:"Emptyparent"+
cy.nodes(":parent").size()+1,name:"Group"},classes:"expanded",group:"nodes"},{data:{displacement:{x:0,y:0},parent:"Emptyparent"+cy.nodes(":parent").size()+1,name:cy.nodes(".page, .control").size()+1,pagestyle:selected_page_template.pagestyle,outputcontainer:selected_page_template.outputcontainer,imgcontainers:selected_page_template.imgcontainers,vidcontainers:selected_page_template.vidcontainers,textcontainers:selected_page_template.textcontainers,decisioncontainers:[],events:[],eventspane:'<div class= "eventscontainer"><span class="eventspanetitle eventname" style="text-align:center; font-size: 16px;">Asset</span><span class="eventspanetitle eventtype" style="text-align:center; font-size: 16px;">Event</span><span class="eventspanetitle eventtrigger" style="text-align:center; font-size: 16px;">Trigger</span></div>'},
classes:"page",group:"nodes",renderedPosition:a.cyRenderedPosition}])))});cy.on("select",function(a){a.cyTarget.isNode()&&a.cyTarget.outgoers().addClass("parent-selected");console.log("Select event fired ",a.cyTarget.data("id"));current_state===states.CONNECTING&&(a.cyTarget.isEdge()&&(defaultState(),showOverlayLinks(a.cyTarget)),cy.$(":selected").diff(a.cyTarget).left.unselect(),console.log("disable ctrl behaviour"),createConnection(a.cyTarget));showOverlayLinks(a.cyTarget);$(".selectionbutton").show()});
cy.on("unselect",function(a){a.cyTarget.isNode()&&a.cyTarget.outgoers().removeClass("parent-selected");console.log("Unselect event fired ",a.cyTarget.data("id"));0===cy.$(":selected").size()?($(".editbutton").hide(),$(".selectionbutton").hide()):showOverlayLinks(cy.$(":selected")[0])});
function createFight(a){console.log(a.cyRenderedPosition);var b=!1;0===cy.elements(".page").size()&&(b=!0);var c=cy.add([{data:{id:"fightparent"+cy.nodes(":parent").size()+1,name:"Fight"},classes:"expanded",group:"nodes",style:{"z-index":cy.nodes(":parent").size()+1}},{data:{displacement:{x:0,y:0},parent:"fightparent"+cy.nodes(":parent").size()+1,name:cy.nodes(".page, .control").size()+1,pagestyle:selected_page_template.pagestyle,outputcontainer:selected_page_template.outputcontainer,imgcontainers:selected_page_template.imgcontainers,
vidcontainers:selected_page_template.vidcontainers,textcontainers:selected_page_template.textcontainers,decisioncontainers:[],events:[],eventspane:'<div class= "eventscontainer"><span class="eventspanetitle eventname" style="text-align:center; font-size: 16px;">Asset</span><span class="eventspanetitle eventtype" style="text-align:center; font-size: 16px;">Event</span><span class="eventspanetitle eventtrigger" style="text-align:center; font-size: 16px;">Trigger</span></div>'},classes:"page",group:"nodes",
renderedPosition:a.cyRenderedPosition},{data:{displacement:{x:-40,y:100},parent:"fightparent"+cy.nodes(":parent").size()+1,name:cy.nodes(".page, .control").size()+2,pagestyle:selected_page_template.pagestyle,outputcontainer:selected_page_template.outputcontainer,imgcontainers:selected_page_template.imgcontainers,vidcontainers:selected_page_template.vidcontainers,textcontainers:selected_page_template.textcontainers,decisioncontainers:[],events:[],eventspane:'<div class= "eventscontainer"><span class="eventspanetitle eventname" style="text-align:center; font-size: 16px;">Asset</span><span class="eventspanetitle eventtype" style="text-align:center; font-size: 16px;">Event</span><span class="eventspanetitle eventtrigger" style="text-align:center; font-size: 16px;">Trigger</span></div>'},
classes:"page",group:"nodes",renderedPosition:a.cyRenderedPosition},{data:{displacement:{x:40,y:100},parent:"fightparent"+cy.nodes(":parent").size()+1,name:cy.nodes(".page, .control").size()+3,pagestyle:selected_page_template.pagestyle,outputcontainer:selected_page_template.outputcontainer,imgcontainers:selected_page_template.imgcontainers,vidcontainers:selected_page_template.vidcontainers,textcontainers:selected_page_template.textcontainers,decisioncontainers:[],events:[],eventspane:'<div class= "eventscontainer"><span class="eventspanetitle eventname" style="text-align:center; font-size: 16px;">Asset</span><span class="eventspanetitle eventtype" style="text-align:center; font-size: 16px;">Event</span><span class="eventspanetitle eventtrigger" style="text-align:center; font-size: 16px;">Trigger</span></div>'},
classes:"page",group:"nodes",renderedPosition:a.cyRenderedPosition}]);b&&c.eq(1).addClass("start");current_state=states.CONNECTING;source_node=null;cy.$(":selected").unselect();createConnection(c.eq(1));createConnection(c.eq(2));createConnection(c.eq(1));createConnection(c.eq(3));$.each(c,function(b,e){if(0<b){var f=this.data("displacement").x,g=this.data("displacement").y;console.log(f);console.log(g);c[b].stop(!1,!0);c[b].animate({position:{x:a.cyPosition.x+f,y:a.cyPosition.y+g}},{duration:500})}});
current_state=states.NEWFIGHT;cy.$("#fightparent"+cy.nodes(":parent").size()+1).select()}function fixDisappearingBug(){0!==cy.$(".start").size()&&cy.$(".start").data("fakeattribute",1)}var fixbug=setInterval(function(){fixDisappearingBug()},200),conditionsContextMenu={};
$.contextMenu({selector:".condition-settings-context-menu",trigger:"left",build:function(a){var b={callback:function(a,b){var c="clicked: "+a;window.console&&console.log(c)||alert(c)},items:{}};a.hasClass("outcome")?(b.items.attMods={name:"Attribute Modifications",items:{}},b.items.textOutput={name:"Text Output To Page",items:{}},b.items.attMods.items.attMod={name:"Attribute Modification",callback:function(b,c){swapOutcome(b,a.attr("id"))}},b.items.textOutput.items.playerOutputAttribute={name:"Player Output (Text : Attribute : Text)",
callback:function(b,c){swapOutcome(b,a.attr("id"))}},b.items.textOutput.items.playerOutputText={name:"Player Output (Text Only)",callback:function(b,c){swapOutcome(b,a.attr("id"))}}):(b.items.attConds={name:"Attribute Conditions",items:{}},b.items.invConds={name:"Inventory Conditions",items:{}},b.items.randConds={name:"Random Number Conditions",items:{}},b.items.attConds.items.type1={name:"Compare Two Attributes",callback:function(b,c){setComparisonType("type1",a.attr("id"))}},b.items.attConds.items.type2=
{name:"Compare Statement and Attribute",callback:function(b,c){setComparisonType("type2",a.attr("id"))}},b.items.attConds.items.type3={name:"Compare Two Statements",callback:function(b,c){setComparisonType("type3",a.attr("id"))}},b.items.invConds.items.type4={name:"Item In Inventory",callback:function(b,c){setComparisonType("type4",a.attr("id"))}},b.items.invConds.items.type5={name:"Amount Of Item In Inventory",callback:function(b,c){setComparisonType("type5",a.attr("id"))}},b.items.randConds.items.type6=
{name:"Random Number Comparison",callback:function(b,c){setComparisonType("type6",a.attr("id"))}});b.items.sep={name:"----------------------------------------------",disabled:!0};var c=a.attr("id").split("_"),d;if("newCondition"===c[0]||"exCondition"===c[0])d="Remove Condition";else if("newOutcome"===c[0]||"exOutcome"===c[0])d="Remove Outcome";b.items.remove={name:d,callback:function(a,b){"Remove Condition"===d?"newCondition"===c[0]?removeCondition(c[0]+"_"+c[1]):removeCondition(c[0]+"_"+c[1]+"_"+
c[2]):"Remove Outcome"===d&&("newOutcome"===c[0]?removeOutcome(c[0]+"_"+c[1]):removeOutcome(c[0]+"_"+c[1]+"_"+c[2]))}};return b}});function addAttributeToContextMenu(a,b,c,d){if(!1===a.is_leaf)for(b.items[a.name]={name:a.name,items:{}},d=0;d<a.childrenArray.length;d++){var e=gameAttributes_find(a.path+"_"+a.childrenArray[d]);addAttributeToContextMenu(e,b.items[a.name],c,a.name)}else b.items[a.name]={name:a.name,callback:function(b,d){handleSelection(b,c.attr("id"),a)}}}
function generateConditionContextMenu(a){var b={callback:function(a,b){},items:{}};a.hasClass("random")&&(b.items.setRandRange={name:"Set Random Number Range",callback:function(b,c){setRandomNumberRange(a.attr("id"))}});if(a.hasClass("random")&&a.hasClass("game-attributes")||a.hasClass("random")&&a.hasClass("numbers"))b.items.sep={name:"----------------------------------------------",disabled:!0};if(a.hasClass("game-attributes"))if(b.items.gameAtts={name:"Game Attributes",items:{}},0<Object.keys(project_project.gameAttributes).length)for(var c in project_project.gameAttributes){var d=
gameAttributes_find(c);addAttributeToContextMenu(d,b.items.gameAtts,a,"")}else b.items.gameAtts.items.err={name:"No attributes available",disabled:!0};a.hasClass("numbers")&&(b.items.specValue={name:"Specific Value",callback:function(b,c){handleSelection(b,a.attr("id"))}},b.items.randValue={name:"Random Value",callback:function(b,c){handleSelection(b,a.attr("id"))}});return b}$.contextMenu({selector:".condition-context-menu",trigger:"left",build:function(a){return generateConditionContextMenu(a)}});
$.contextMenu({selector:".condition-context-menu-right",trigger:"right",build:function(a){return generateConditionContextMenu(a)}});
$.contextMenu({selector:".comparison-context-menu",trigger:"left",build:function(a){var b={callback:function(a,b){var e="clicked: "+a;window.console&&console.log(e)||alert(e)},items:{}};a.hasClass("comparison-context-menu")&&(a.hasClass("comps")&&(b.items.comparison={name:"comparison",items:{"=":{name:"=",callback:function(b,d){$("#"+a.attr("id")).text(b)}},"<":{name:"<",callback:function(b,d){$("#"+a.attr("id")).text(b)}},">":{name:">",callback:function(b,d){$("#"+a.attr("id")).text(b)}},"<=":{name:"<=",
callback:function(b,d){$("#"+a.attr("id")).text(b)}},">=":{name:">=",callback:function(b,d){$("#"+a.attr("id")).text(b)}}}}),a.hasClass("mods")&&(b.items.modifier={name:"Modifier",items:{"+":{name:"+",callback:function(b,d){$("#"+a.attr("id")).text(b)}},"-":{name:"-",callback:function(b,d){$("#"+a.attr("id")).text(b)}},"*":{name:"*",callback:function(b,d){$("#"+a.attr("id")).text(b)}},"/":{name:"/",callback:function(b,d){$("#"+a.attr("id")).text(b)}}}},a.hasClass("equals")&&(b.items.modifier.items["="]=
{name:"=",callback:function(b,d){$("#"+a.attr("id")).text(b)}})));return b}});
function setComparisonType(a,b){var c=b.split("_"),d="";"newCondition"===c[0]?b=c[0]+"_"+c[1]:"exCondition"===c[0]&&(b=c[0]+"_"+c[1]+"_"+c[2]);switch(a){case "type1":d=generateCondition_type1(b);$("#"+b).replaceWith(d);initAttributeButton(b+"_attButton_s1_1");initAttributeButton(b+"_attButton_s1_2");break;case "type2":d=generateCondition_type2(b);$("#"+b).replaceWith(d);initAttributeButton(b+"_attButton_s1_1");initAttributeButton(b+"_attButton_s1_2");initAttributeButton(b+"_attButton_s2_1");break;
case "type3":d=generateCondition_type3(b);$("#"+b).replaceWith(d);initAttributeButton(b+"_attButton_s1_1");initAttributeButton(b+"_attButton_s1_2");initAttributeButton(b+"_attButton_s2_1");initAttributeButton(b+"_attButton_s2_2");break;case "type4":d=generateCondition_type4(b);$("#"+b).replaceWith(d);break;case "type5":d=generateCondition_type5(b);$("#"+b).replaceWith(d);break;case "type6":d=generateCondition_type6(b),$("#"+b).replaceWith(d),$("#"+b+"_randButton").tooltip({delay:50})}}
function handleSelection(a,b,c){console.log(a);"randValue"===a?randomSelected(b):"specValue"===a?numberSelected(b):"attButton"!==b.split("_")[2]?attributeSelected(a,b,c):($("#"+b).children().text(a),$("#"+b).attr("path",c.path),updateTooltip(b,c.path))}
function attributeSelected(a,b,c){var d=b.split("_"),e;"newCondition"===d[0]?(e=d[0]+"_"+d[1]+"_attButton_"+d[3]+"_"+d[4],newButton=generateAttributeButton(e,"game-attributes numbers"),$("#"+b).parent().replaceWith(newButton)):"exCondition"===d[0]?(e=d[0]+"_"+d[1]+"_"+d[2]+"_attButton_"+d[4]+"_"+d[5],newButton=generateAttributeButton(e,"game-attributes numbers"),$("#"+b).parent().replaceWith(newButton)):"newOutcome"===d[0]?(e=d[0]+"_"+d[1]+"_attButton_"+d[3],newButton=generateAttributeButton(e,"game-attributes numbers"),
$("#"+b).parent().replaceWith(newButton)):"exOutcome"===d[0]?(e=d[0]+"_"+d[1]+"_"+d[2]+"_attButton_"+d[4],newButton=generateAttributeButton(e,"game-attributes numbers"),$("#"+b).parent().replaceWith(newButton)):"inventoryItem"==d[0]&&(e=b);console.log(e+" "+c.path);$("#"+e).text(a);$("#"+e).attr("path",c.path);updateTooltip(e,c.path)}
function numberSelected(a){var b=a.split("_"),c;"newCondition"===b[0]?c=b[0]+"_"+b[1]+"_specValue_"+b[3]+"_"+b[4]:"exCondition"===b[0]?c=b[0]+"_"+b[1]+"_"+b[2]+"_specValue_"+b[4]+"_"+b[5]:"newOutcome"===b[0]?c=b[0]+"_"+b[1]+"_specValue_"+b[3]:"exOutcome"===b[0]&&(c=b[0]+"_"+b[1]+"_"+b[2]+"_specValue_"+b[4]);b=generateInputField(c,"condition-context-menu-right game-attributes numbers");$("#"+a).parent().replaceWith(b)}
function randomSelected(a){var b=a.split("_"),c;"newCondition"===b[0]?(c=b[0]+"_"+b[1]+"_randValue_"+b[3]+"_"+b[4],b=generateRandomButton(c,"condition-context-menu game-attributes numbers"),$("#"+a).parent().replaceWith(b)):"exCondition"===b[0]?(c=b[0]+"_"+b[1]+"_"+b[2]+"_randValue_"+b[4]+"_"+b[5],b=generateRandomButton(c,"condition-context-menu game-attributes numbers"),$("#"+a).parent().replaceWith(b)):"newOutcome"===b[0]?(c=b[0]+"_"+b[1]+"_randValue_"+b[3],b=generateRandomButton(c,"condition-context-menu game-attributes numbers"),
$("#"+a).parent().replaceWith(b)):"exOutcome"===b[0]&&(c=b[0]+"_"+b[1]+"_"+b[2]+"_randValue_"+b[4],b=generateRandomButton(c,"condition-context-menu game-attributes numbers"),$("#"+a).parent().replaceWith(b));$("#"+c).tooltip({delay:50})}
function setRandomNumberRange(a){myModal.prompt("Set Random Number Range","Set the minimum and maximum values to be generated.",[{name:"Minimum","default":parseFloat($("#"+a).attr("min")),type:"number"},{name:"Maximum","default":parseFloat($("#"+a).attr("max")),type:"number"}],function(b){$("#"+a).attr("min",b[0]);$("#"+a).attr("max",b[1]);$("#"+a).attr("data-tooltip","Minimum: "+b[0]+"<br>Maximum: "+b[1]);$("#"+a).tooltip({delay:50});return!0},function(a){return parseFloat(a[0])>parseFloat(a[1])?
(myModal.warning("Minimum field cannot be greater than Maximum field"),!1):!0})}function generateCondition_type1(a){return"<li id="+a+'><div class="row" type="1">'+generateSettingsButton(a)+generateAttributeButton(a+"_attButton_s1_1","game-attributes")+generateComparisonButon(a+"_compMenu_s1","comps","=")+generateAttributeButton(a+"_attButton_s1_2","game-attributes numbers")+'</div><div class="divider"></div></li>'}
function generateCondition_type2(a){return"<li id="+a+'><div class="row" type="2">'+generateSettingsButton(a)+generateAttributeButton(a+"_attButton_s1_1","game-attributes")+generateComparisonButon(a+"_compMenu_s1","mods","+")+generateAttributeButton(a+"_attButton_s1_2","game-attributes numbers")+generateComparisonButon(a+"_pivot","comps","=")+generateAttributeButton(a+"_attButton_s2_1","game-attributes numbers")+'</div><div class="divider"></div></li>'}
function generateCondition_type3(a){return"<li id="+a+'><div class="row" type="3">'+generateSettingsButton(a)+generateAttributeButton(a+"_attButton_s1_1","game-attributes")+generateComparisonButon(a+"_compMenu_s1","mods","+")+generateAttributeButton(a+"_attButton_s1_2","game-attributes numbers")+generateComparisonButon(a+"_pivot","comps","=")+generateAttributeButton(a+"_attButton_s2_1","game-attributes numbers")+generateComparisonButon(a+"_compMenu_s2","mods","+")+generateAttributeButton(a+"_attButton_s2_2",
"game-attributes numbers")+'</div><div class="divider"></div></li>'}function generateCondition_type4(a){return"<li id="+a+'><div class="row" type="4">'+generateSettingsButton(a)+generateInventoryButton(a+"_invButton")+generateExistsButton(a+"_existsButton")+'</div><div class="divider"></div></li>'}
function generateCondition_type5(a){return"<li id="+a+'><div class="row" type="5">'+generateSettingsButton(a)+generateInventoryButton(a+"_invButton")+generateInputField(a+"_inputField","","Amount In Inventory")+'</div><div class="divider"></div></li>'}
function generateCondition_type6(a){return"<li id="+a+'><div class="row" type="1">'+generateSettingsButton(a)+generateRandomButton(a+"_randButton","condition-context-menu")+generateComparisonButon(a+"_compMenu_s1","comps","=")+generateInputField(a+"_inputField","","Enter Number")+'</div><div class="divider"></div></li>'}
function generateOutcome(a){return"<li id="+a+'><div class="row" type="Attribute Modification">'+generateSettingsButton(a)+generateAttributeButton(a+"_attButton_1","game-attributes")+generateComparisonButon(a+"_compMenu","mods equals","+")+generateAttributeButton(a+"_attButton_2","game-attributes numbers")+'</div><div class="divider"></div></li>'}
function generatePlayerOutputAttribute(a){return"<li id="+a+'><div class="row" type="Text-Attribute-Text">'+generateSettingsButton(a)+generateTextButton(a+"_text_1")+generateAttributeButton(a+"_attButton_1","game-attributes")+generateTextButton(a+"_text_2")+'</div><div class="divider"></div></li>'}function generatePlayerOutputText(a){return"<li id="+a+'><div class="row" type="Text">'+generateSettingsButton(a)+generateTextButton(a+"_text_1")+'</div><div class="divider"></div></li>'}
function generateAttributeButton(a,b,c){return'<div class="col s2"><div id="'+a+'" class="condition-context-menu '+b+' attribute-button tooltipped" data-html="true" data-position="bottom" data-delay="50" data-tooltip=""><p class="truncate"></p></div></div>'}function generateComparisonButon(a,b,c){return'<div id="'+a+'" class="col s1 comparison-context-menu '+b+' comparison-button">'+c+"</div>"}
function generateSettingsButton(a){return"newOutcome"===a.split("_")[0]||"exOutcome"===a.split("_")[0]?'<div class="col s1"><div id="'+a+'_settings" class="condition-settings-context-menu outcome condition-settings-button"><a class="btn-floating waves-effect waves-light gray"><i class="material-icons">settings</i></a></div></div>':'<div class="col s1"><div id="'+a+'_settings" class="condition-settings-context-menu condition-settings-button"><a class="btn-floating waves-effect waves-light gray"><i class="material-icons">settings</i></a></div></div>'}
function generateRandomButton(a,b){return'<div class="col s2"><div id="'+a+'" class="random attribute-button tooltipped '+b+'" max="100" min="0" data-html="true" data-position="bottom" data-delay="50" data-tooltip="Minimum: 0<br>Maximum: 100">Random Number</div></div>'}
function generateTextButton(a){return'<div class="col s2 truncate"><div id="'+a+'" onclick=editTextModal(this.id) class="attribute-button tooltipped" data-html="true" data-position="bottom" data-delay="50" data-tooltip=""><p class="truncate">Click to add text</p></div></div>'}
function generateInventoryButton(a){return'<div class="col s2 truncate"><div id="'+a+'" class="attribute-button tooltipped inventory-context-menu" data-html="true" data-position="bottom" data-delay="50" data-tooltip="" itemid="" ><p class="truncate">.....</p></div></div>'}
function generateInputField(a,b,c){void 0===c&&(c="Enter Value");return'<div class="input-field col s2"><input placeholder="'+c+'" id="'+a+'_inputField" type="number" class="input-field autosetvalue '+b+' "><label for="'+a+'_inputField">'+c+"</label></div>"}function generateExistsButton(a){return'<div class="col s2 truncate"><a href="#" ><div id="'+a+'" state="false" onclick=existsButtonSwapState(this.id) class="attribute-button"><p class="truncate">Not in inventory</p></div></a></div>'}
function existsButtonSwapState(a){"false"===$("#"+a).attr("state")?($("#"+a).children().text("Is in inventory"),$("#"+a).attr("state","true")):($("#"+a).children().text("Not in inventory"),$("#"+a).attr("state","false"))}function findFirstLeafPath(a){var b=gameAttributes_find(a);if(!1===b.is_leaf)for(var c=0;c<b.childrenArray.length;c++){var d=findFirstLeafPath(a+"_"+b.childrenArray[c]);if(void 0!==d)return d}else return a}
function initAttributeButton(a){if(0<Object.keys(project_project.gameAttributes).length)for(var b in project_project.gameAttributes){var c=findFirstLeafPath(b);if(void 0!==c){b=gameAttributes_find(c);$("#"+a).children().text(b.name);$("#"+a).attr("path",c);updateTooltip(a,c);break}}else $("#"+a).children().text("..........."),$("#"+a).attr("path",""),$("#"+a).attr("data-tooltip","There are no attributes in your project. <br> Add attributes via the 'Attributes' button. "),$("#"+a).tooltip({delay:50})}
function updateTooltip(a,b){for(var c=b.split("_"),d="",e="",f=0;f<c.length;f++){var e=0===f?e+c[0]:e+("_"+c[f]),g=gameAttributes_find(e),d=d+g.name;f!==c.length-1&&(d+=" > ")}$("#"+a).attr("data-tooltip",d);$("#"+a).tooltip({delay:50})}
function swapOutcome(a,b){var c,d;c=b.split("_");"newOutcome"===c[0]?d=c[0]+"_"+c[1]:"exOutcome"===c[0]&&(d=c[0]+"_"+c[1]+"_"+c[2]);"attMod"===a?(c=generateOutcome(d),$("#"+d).replaceWith(c),initAttributeButton(d+"_attButton_1"),initAttributeButton(d+"_attButton_2")):"playerOutputAttribute"===a?(c=generatePlayerOutputAttribute(d),$("#"+d).replaceWith(c),initAttributeButton(d+"_attButton_1"),$("#"+d+"_text_1").tooltip({delay:50}),$("#"+d+"_text_2").tooltip({delay:50})):"playerOutputText"===a&&(c=generatePlayerOutputText(d),
$("#"+d).replaceWith(c),$("#"+d+"_text_1").tooltip({delay:50}))}function editTextModal(a){var b=$("#"+a).attr("data-tooltip");myModal.prompt("Modify Text For Player Output","Specify the text that appears in the control output of the following page during gameplay.",[{name:"Text","default":b,type:"text"}],function(b){$("#"+a).children().text('"'+b[0]+'"');$("#"+a).attr("data-tooltip",b[0]);$("#"+a).tooltip({delay:50})},function(a){return!0})}
function setInputFieldValues(){$(".autosetvalue").each(function(a,b){console.log($(b).val());$(b).attr("value",$(b).val())})}function setInventoryButtonSelection(a,b){var c=gameInventory_getItem(b);$("#"+a).children().text(c.name);$("#"+a).attr("data-tooltip",c.name);$("#"+a).attr("itemid",c.itemID);$("#"+a).tooltip({delay:50})}
$.contextMenu({selector:".inventory-context-menu",trigger:"left",build:function(a){var b={items:{}};if(0<Object.keys(project_project.gameInventory).length){b.items.inventory={name:"Inventory Item",items:{}};for(var c in project_project.gameInventory){var d=gameInventory_getItem(c);console.log(d);b.items.inventory.items[c]={name:d.name,callback:function(b,c){setInventoryButtonSelection(a.attr("id"),d.itemID)}}}}else b.items.err={name:"No inventory items available",disabled:!0};return b}});
var gameAttributes={};function GameAttribute(a,b,c,d,e,f,g,h){this.name=c;this.is_leaf=e;this.value=f;this.maxValue=h;this.minValue=g;this.parentPath=a;this.id=d;null!=a?(this.level=b+1,this.path=a+"_"+d):(this.path=d,this.level=0);this.childrenArray=[]}function gameAttributes_addAttribute(a,b,c,d,e){gameAttributes_addChild(a,b,!0,c,d,e)}function gameAttributes_addAttributeFolder(a,b){gameAttributes_addChild(a,b,!1)}
function gameAttributes_addChild(a,b,c,d,e,f){var g=generateID();console.log(a);"TOP_LEVEL"!=a?(console.log("New Child: "+b),a=gameAttributes_find(a),console.log(a),a[g]=new GameAttribute(a.path,a.level,b,g,c,d,e,f),d=a[g],a.childrenArray.push(g),console.log("New Nested attribute added under: "+a.path),console.log("New Attribute ID: "+g),g="'"+d.path+"'",b=c?'<li class="'+d.path+'-list-element margin"><a class="'+d.path+'-name" onclick="gameAttributes_display('+g+')">'+b+"</a></li>":'<li id="'+d.id+
'-list-element" class="'+d.path+'-list-element margin pointer"><a class="'+d.path+'-name" onclick="gameAttributes_display('+g+')">'+b+'</a><ul id="'+d.path+'-inner_list"></ul></li>',$("#"+a.path+"-inner_list").append(b),gameAttributes_display(a.path)):(project_project.gameAttributes[g]=new GameAttribute(null,null,b,g,!1),b='<li class="'+g+'-list-element margin pointer"><a onclick="gameAttributes_display(\''+g+"')\">"+b+'</a><ul id="'+g+'-inner_list"></ul></li>',$("#attributes-list").append(b),console.log("new top level attribute added: "+
project_project.gameAttributes[g].path))}function gameAttributes_find(a){path=a.split("_");a=project_project.gameAttributes;for(var b=0;b<path.length;b++)a=a[path[b]];return a}function gameAttribute_edit(a){var b=$("#"+a+"-name-input"),c=$("#"+a+"-value-input"),d=$("#"+a+"-min-value-input"),e=$("#"+a+"-max-value-input");a=gameAttributes_update(a,b.val(),c.val(),d.val(),e.val());gameAttributes_display(a.parentPath)}
function gameAttributes_update(a,b,c,d,e){a=gameAttributes_find(a);null!=b&&""!=b&&(a.name=b,$("."+a.path+"-name").text(b));a.value=c;a.minValue=d;a.maxValue=e;console.log(a+" Updated");$("#"+a.id+"-value").text(c);$("#"+a.id+"-min-value").text(d);$("#"+a.id+"-max-value").text(e);return a}
function gameAttributes_delete(a){path=a.split("_");a=project_project.gameAttributes;for(var b=0;b<path.length-1;b++)a=a[path[b]];console.log(a);console.log("Deleting - "+a[path[path.length-1]].path);$("."+a[path[path.length-1]].path+"-list-element").remove();a.childrenArray.splice($.inArray(a[path[path.length-1]].id,a.childrenArray),1);a[path[path.length-1]]=null;delete a[path[path.length-1]]}
function gameAttributes_display(a){var b=gameAttributes_find(a);console.log("displaying attribute in panel: "+b.name);var c=$("#values-list"),d=$("#folders-list"),e=$(".current-attribute-name");console.log(a);$(".new-attribute-input").attr("data-path",a);$(".new-folder-input").attr("data-path",a);$("#add_attribute_input_container_show_button").show();var f=$("#add_sub_folder_button");f.show();f.attr("data-path",a);f=$("#add_attribute_values_button");f.show();f.attr("data-path",a);if(!b.is_leaf)for(c.empty(),
d.empty(),e.text(b.name),a=0;a<b.childrenArray.length;a++)e=b[b.childrenArray[a]],e.is_leaf?c.append('<li class="'+e.path+'-list-element"><div class="collapsible-header"><span class="'+e.path+'-name">'+e.name+'</span></div><div class="collapsible-body"><div class="row pos-relative " style="height: 50px;" ><div class="col m2 attribute_float-bottom pos-absolute"><span>Value: <span id="'+e.id+'-value">'+e.value+'</span></span></div><div class="col m4 offset-m2 attribute_float-bottom pos-absolute"><span>Value Range: <span id="'+
e.id+'-min-value">'+e.minValue+'</span> to <span id="'+e.id+'-max-value">'+e.maxValue+'</span></span></div><div class="col m3 offset-m9 attribute_float-bottom pos-absolute"><a class="btn-floating btn-small waves-effect waves-light red delete-button" id="'+e.path+'-delete-button" data-path="'+e.path+'" onclick="gameAttributes_delete(\''+e.path+'\')"><i class="small material-icons">delete</i></a><a class="btn-floating btn-small waves-effect waves-light blue edit-button" id="'+e.path+'-edit-button" data-path="'+
e.path+'" onclick="gameAttributes_openEditAttributeModal(this)"><i class="small material-icons">mode_edit</i></a> </div></div></div></li>'):d.append('<a class="collection-item pointer" onclick="gameAttributes_display(\''+e.path+"')\">"+e.name+"</a>")}function generateID(){for(var a="",b=0;4>b;b++)a+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(Math.floor(62*Math.random()));return a}
function gameAttributes_saveAttributes(){project_project.attributeHTML=$("#attributes-list").html()}function gameAttributes_loadAttributes(){$("#attributes-list").html(project_project.attributeHTML)}$(".add-value").keypress(function(a){if(13==a.which){a=$("#add-value-name");var b=$("#add-value-data");gameAttributes_addAttribute(a.attr("data-path"),a.val(),b.val());b.val("");a.val("");gameAttributes_display(a.attr("data-path"));$("#new-value-button").parent().show();$("#new-value-container").hide()}});
$("#add-top-level-name").keypress(function(a){13==a.which&&(a=$("#add-top-level-name"),project_addTopGameAttributeFolder(a.val()),a.val(""),$("#new-top-level-button").show(),$("#new-top-level-container").hide())});$("#add-attribute-confirm").click(function(){gameAttributes_addAttributeFromHtml()});$(".new-attribute-input").keypress(function(a){13==a.which&&gameAttributes_addAttributeFromHtml()});
function gameAttributes_addAttributeFromHtml(){var a=$("#new_attribute_name_input"),b=$("#new_attribute_value_input"),c=$("#new_attribute_min_input"),d=$("#new_attribute_max_input");gameAttributes_addAttribute(a.attr("data-path"),a.val(),b.val(),c.val(),d.val());$("#add_attribute_input_container").hide();$("#add_attribute_input_container_show_button").show();a.val("");b.val("");c.val("");d.val("");gameAttributes_display(a.attr("data-path"))}$("#add-folder-confirm").click(function(){gameAttributes_addFolderFromHtml()});
$(".new-folder-input").keypress(function(a){13==a.which&&gameAttributes_addFolderFromHtml()});function gameAttributes_addFolderFromHtml(){var a=$("#new_folder_name_input");gameAttributes_addAttributeFolder(a.attr("data-path"),a.val());$("#add_folder_input_container").hide();$("#add_folder_input_container_show_button").show();a.val("");gameAttributes_display(a.attr("data-path"))}
function gameAttributes_openAddFolderModal(a){myModal.prompt("Add an Attribute Folder","Folders contain attribute values and other attribute folders. Use them to help organise your attributes.",[{name:"New Folder Name","default":"",type:"text"}],function(b){b=b[0];gameAttributes_addAttributeFolder($(a).attr("data-path"),b)},function(a){console.log("Verifying ",a[0]);if(""==a[0])return console.log("No Folder name entered"),Materialize.toast("Please enter a folder name",3E3,"rounded"),!1;console.log("Folder name successfully verified");
return!0})}
function gameAttributes_openAddAttributeModal(a){myModal.prompt("Add an Attribute","Attributes have values, minimum values, maximum value.",[{name:"Attribute Name","default":"",type:"text"},{name:"Attribute Value","default":"0",type:"number"},{name:"Minimum Value","default":"",type:"number"},{name:"Maximum Value","default":"",type:"number"}],function(b){gameAttributes_addAttribute($(a).attr("data-path"),b[0],b[1],b[2],b[3])},function(a){console.log("Verifying ",a[0]);var c=!0;""==a[0]&&(console.log("No Folder name entered"),
Materialize.toast("Please enter an attribute name",3E3,"rounded"),c=!1);if(a[1]<a[2]||a[1]>a[3]||a[2]>a[3])console.log("Illegal attribute values"),Materialize.toast("Conflicting Attribute Values",3E3,"rounded"),c=!1;return c})}
function gameAttributes_openEditAttributeModal(a){var b=gameAttributes_find($(a).attr("data-path"));myModal.prompt("Update "+b.name,"Update the fields below",[{name:"Attribute Name","default":b.name,type:"text"},{name:"Attribute Value","default":b.value,type:"number"},{name:"Minimum Value","default":b.minValue,type:"number"},{name:"Maximum Value","default":b.maxValue,type:"number"}],function(b){gameAttributes_update($(a).attr("data-path"),b[0],b[1],b[2],b[3])},function(a){console.log("Verifying ",
a[0]);var b=!0;""==a[0]&&(console.log("No Attribute name entered"),Materialize.toast("Please enter an attribute name",3E3,"rounded"),b=!1);if(a[1]<a[2]||a[1]>a[3]||a[2]>a[3]||""==(a[2]||a[3]))console.log("Illegal attribute values"),Materialize.toast("Conflicting Attribute Values",3E3,"rounded"),b=!1;return b})}var gameInventory={};
function InventoryItem(a){this.itemID=a.itemID;this.name=a.name;this.description=a.description;this.initCount=a.initCount;this.modifiers=a.modifiers;this.playCount=this.initCount}function gameInventory_defineItem(a,b){var c="item-"+generateID();project_project.gameInventory[c]=new InventoryItem(c,a,b)}function gameInventory_editItem(a,b,c){a=project_project.gameInventory[a];a.name=b;a.description=c;return a}
function gameInventory_deleteItem(a){project_project.gameInventory[a]=null;delete project_project.gameInventory[a]}function gameInventory_getItem(a){return project_project.gameInventory[a]}function gameInventory_addModifier(a,b,c){project_project.gameInventory[a].modifiers[b]=c}function gameInventory_deleteModifier(a,b){void 0!=project_project.gameInventory[a]&&(project_project.gameInventory[a].modifiers[b]=null,delete project_project.gameInventory[a].modifiers[b])}
function gameInventory_getAllItemModifiers(a){var b=[],c;for(c in project_project.gameInventory[a].modifiers)b.push(project_project.gameInventory[a].modifiers[c]);return b}function gameInventory_createModule_defineItem(){var a="item-"+generateID();defineItemModal.prompt(a,!0)}function gameInventory_createModule_updateItem(a){defineItemModal.prompt(a,!1)}
function gameInventory_createModule_updateItemHtml(a){var b=$("."+a+"-name"),c=$("."+a+"-description"),d=$("."+a+"-initCount"),e=$("."+a+"-modifiers-list"),f=project_project.gameInventory[a];b.text(f.name);c.text(f.description);d.text(f.initCount);e.empty();for(var g in project_project.gameInventory[a].modifiers)b=project_project.gameInventory[a].modifiers[g],e.append('<div class="chip">'+gameAttributes_find(b.attributePath).name+"+"+b.modifierValue+"</div>")}
function gameInventory_createModule_deleteItem(a){$("."+a+"-list-element").remove();gameInventory_deleteItem(a)}
function gameInventory_createModule_appendItemDiv(a,b){var c='<li class="'+a+'-list-element"><div class="collapsible-header"><span class="'+a+'-name">'+b.name+'</span></div><div class="collapsible-body"><div class="row pos-relative "><div class="col m6"><h6><i class="material-icons small">subject</i>Description: </h6><hr/><p class="'+a+'-description">'+b.description+'</p></div><div class="col m6"><h6><i class="material-icons small">stars</i>Modifiers: </h6><hr/> <div class="'+a+'-modifiers-list"></div> </div> </div><hr/><div class="row" style="margin-bottom: 1px"><div class="col m4"> Initial Count: <span class="'+
a+'-initCount"></span></div><div class="col m1 offset-m9"><a class="btn-floating btn-small waves-effect waves-light blue edit-button" onclick="gameInventory_createModule_updateItem(\''+a+'\')"><i class="small material-icons">mode_edit</i></a> &nbsp;</div><div class="col m1"><a class="btn-floating btn-small waves-effect waves-light red delete-button"  onclick="gameInventory_createModule_deleteItem(\''+a+'\')"><i class="small material-icons">delete</i></a></div></div></div></div></div></li>';$(".inventory-item-list").append(c)}
function gameInventory_createModule_populateItemsList(){for(var a in project_project.gameInventory)gameInventory_createModule_appendItemDiv(a,project_project.gameInventory[a]),gameInventory_createModule_updateItemHtml(a)}
function DefineItemModal(){this.isNewItem=this.confirm=!1;this.currentItemID=null;this.modifierCount=0;this.init=function(){$("body").append('<div id="define-item-modal" class=" modal modal-fixed-footer"><div class="modal-content"><div class="row row-centered"><h3>Define Item</h3><div class="input-field col m6"><input id="item-name-input" class="validate"  type="text"/><label for="item-name-input" data-error="Required" class="active" >Item Name</label></div><div class="input-field col m2 offset-m4"><input id="item-initCount-input" class="validate" value="0" type="number"/><label for="item-initCount-input" data-error="Required" class="active" >Initial Item Count</label></div><div class="input-field col m6"><textarea id="item-detail-input" class="materialize-textarea"></textarea><label for="item-detail-input" class="active">Item Description</label></div><button class="col m4 offset-m2 btn tooltiped" data-tooltip="Modifiers will modify attributes when they are in a players inventory" onclick="defineItemModal.addModifierInput(true);" style="margin-top: 75px;">Add Attribute Modifier</button></div><div class="row row-centered"><ul class="item-modifiers-input-list"></ul></div></div><div class="modal-footer"><a href="#!" class=" modal-action modal-close waves-effect waves-red btn-flat" onclick="defineItemModal.evaluateModal(false)">Cancel</a><a href="#!" class=" modal-action waves-effect waves-green btn-flat" onclick="defineItemModal.evaluateModal(true)">Confirm</a></div></div>')};this.prompt=
function(a,b){var c=$("#item-name-input"),d=$("#item-detail-input"),e=$("#item-initCount-input"),f=$(".item-modifiers-input-list"),g=null;this.currentItemID=a;this.isNewItem=b;this.modifierCount=0;$("#item-modifiers-input-list").empty();if(!this.isNewItem){g=project_project.gameInventory[a];c.val(g.name);d.val(g.description);d.trigger("autoresize");e.val(g.initCount);for(var h in project_project.gameInventory[a].modifiers)this.addModifierInput(!1,h,project_project.gameInventory[a].modifiers[h])}$("#define-item-modal").openModal({dismissible:!0,
ready:function(){},complete:function(){c.val("");d.val("");e.val("");f.empty()}})};this.evaluateModal=function(a){var b=$("#item-name-input"),c=$("#item-detail-input"),d=$("#item-initCount-input"),e=$(".item-modifiers-input-list"),f=$(".modifier-value-input");if(a){var g=!1;void 0!=b.val()&&""!=b.val()&&void 0!=d.val()&&""!=d.val()&&(g=!0);var h=!0;f.each(function(){if(""==$(this).val()||void 0==$(this).val())$(this).addClass("invalid"),g=h=!1});if(g)a={name:b.val(),itemID:this.currentItemID,description:c.val(),
initCount:d.val(),modifiers:this.evaluateModifiers()},this.isNewItem?(project_project.gameInventory[this.currentItemID]=new InventoryItem(a),gameInventory_createModule_appendItemDiv(this.currentItemID,project_project.gameInventory[this.currentItemID])):project_project.gameInventory[this.currentItemID]=a,gameInventory_createModule_updateItemHtml(this.currentItemID),void 0!=c.val()&&""!=c.val()||c.val("No description provided"),$("#define-item-modal").closeModal(),b.val(""),c.val(""),d.val("0"),e.empty();
else{console.log("item definition validation failed");if(void 0==b.val()||""==b.val())Materialize.toast("Please provide an item name",5E3,"rounded","dismissible"),b.addClass("invalid");if(void 0==d.val()||""==d.val())Materialize.toast("Please provide an item count",7E3,"rounded","dismissible"),d.addClass("invalid");h||Materialize.toast("Please provide valid attribute modifier values",9E3,"rounded","dismissible")}}else $("#define-item-modal").closeModal(),b.val(""),c.val(""),d.val("0"),e.empty()};
this.addModifierInput=function(a,b,c){b=a?"modifier-"+generateID():b;var d="<li id=inventoryItemModifierRow_"+b+'><div class="row">'+generic_generateAttributeButton(b+"-modifyAttributeInput","game-attributes")+'<div class="input-field col m2"><input id="'+b+'-modifyAmountInput" type="number" class="modifier-value-input validate"/><label data-error="Required" class="active">Modify Amount</label></div><div class="col m1"><button class="btn-floating red offset-m2" style="margin-top: 20px;" onclick="defineItemModal.removeModifierInput(\''+
b+'\');"><i class="small material-icons">delete</i></button></div></div><div class="divider"></div></li>';this.modifierCount++;$(".item-modifiers-input-list").append(d);$("select").material_select();a?initAttributeButton(b+"-modifyAttributeInput"):($("#"+b+"-modifyAmountInput").val(c.modifierValue),$("#"+b+"-modifyAttributeInput").text(gameAttributes_find(c.attributePath).name),$("#"+b+"-modifyAttributeInput").attr("path",c.attributePath),updateTooltip(b,c.attributePath))};this.removeModifierInput=
function(a){$("#inventoryItemModifierRow_"+a).remove();this.modifierCount--};this.evaluateModifiers=function(){var a=[],b={};$(".item-modifiers-input-list").children().each(function(){a.push($(this).attr("id").split("_")[1])});for(var c=0;c<a.length;c++){var d=a[c],e=$("#"+d+"-modifyAttributeInput").attr("path"),f=$("#"+d+"-modifyAmountInput").val();b[d]={attributePath:e,modifierValue:f}}return b}}var defineItemModal=new DefineItemModal;defineItemModal.init();var genericComparisonRow={};
function generic_example(){generic_addRow("row_1_","your-settings-menu","exampleList")}function generic_addRow(a,b,c){$("#"+c).append(generic_generateRow(a,b));initAttributeButton(a+"attButton1");initAttributeButton(a+"attbutton2")}$.contextMenu({selector:".your-settings-menu",trigger:"left",build:function(a){a={items:{}};a.items.dosomething={name:"do something",callback:function(a,c){alert("Done something")}};return a}});
function generic_generateRow(a,b){return"<li id="+a+'><div class="row" type="1">'+generic_generateAttributeButton(a+"attButton1","game-attributes")+generateComparisonButon(a+"_compMenu","comps","=")+generic_generateAttributeButton(a+"attbutton2","game-attributes numbers")+generic_yourSettingsButton(a,b)+'</div><div class="divider"></div></li>'}
function generic_yourSettingsButton(a,b){return'<div class="col s1"><div id="'+a+'_settings" class="'+b+' condition-settings-button"><a class="btn-floating waves-effect waves-light red"><i class="material-icons">delete</i></a></div></div>'}$.contextMenu({selector:".generic-attributes-menu",trigger:"left",build:function(a){return generic_generateContextMenu(a)}});$.contextMenu({selector:".generic-attributes-menu-right",trigger:"right",build:function(a){return generic_generateContextMenu(a)}});
function generic_generateContextMenu(a){var b={items:{}};if(0<Object.keys(project_project.gameAttributes).length)for(var c in project_project.gameAttributes){var d=gameAttributes_find(c);generic_addFolderToContextMenu(d,b,a)}else b.items.err={name:"No attributes available",disabled:!0};a.hasClass("numbers")&&(b.items.specValue={name:"Specific Value",callback:function(b,c){generic_numberSelected(a.attr("id"))}});return b}
function generic_addFolderToContextMenu(a,b,c){if(!1===a.is_leaf){b.items[a.name]={name:a.name,items:{}};for(var d=0;d<a.childrenArray.length;d++){var e=gameAttributes_find(a.path+"_"+a.childrenArray[d]);generic_addFolderToContextMenu(e,b.items[a.name],c,a.name)}}else b.items[a.name]={name:a.name,callback:function(b,d){generic_attributeSelected(c.attr("id"),a)}}}
function generic_generateAttributeButton(a,b,c){return"NO_COL"===c?'<div id="'+a+'" class="generic-attributes-menu '+b+' attribute-button tooltipped" data-html="true" data-position="bottom" data-delay="50" data-tooltip=""><p class="truncate"></p></div>':'<div class="col s4"><div id="'+a+'" class="generic-attributes-menu '+b+' attribute-button tooltipped" data-html="true" data-position="bottom" data-delay="50" data-tooltip=""><p class="truncate"></p></div></div>'}
function generic_numberSelected(a){var b=a+"_specValue",b='<div id="'+b+'" class="input-field"><input placeholder="Enter Value" id="'+b+'_inputField" type="number" class="input-field generic-attributes-menu-right numbers"></div>';$("#"+a).replaceWith(b)}
function generic_attributeSelected(a,b){var c="",d="",d=$("#"+a).hasClass("input-field")?c=$("#"+a).closest("div").prop("id"):c=a,e=$("#"+c).hasClass("numbers")?generic_generateAttributeButton(d,"game-attributes numbers","NO_COL"):generic_generateAttributeButton(d,"game-attributes","NO_COL");$("#"+c).replaceWith(e);$("#"+d).children().text(b.name);$("#"+d).attr("path",b.path);updateTooltip(d,b.path)}var hotkeys={},nodes_to_clone;
$(document).ready(function(){var a=!1;$("html").on("keyup",function(b){if(17==b.which||91==b.which)a=!1}).on("keydown",function(b){if(17==b.which||91==b.which)a=!0;if($(".modal").hasClass("open"))$("#prompt-modal").hasClass("open")&&(13==b.which?myModal.evaluateModal(!0):27==b.which&&myModal.evaluateModal(!1));else if(console.log(b.which),a&&67==b.which)0!=cy.$(":selected").length&&(console.log("Copy"),nodes_to_clone=cy.$(":selected").nodes().jsons(),console.log(nodes_to_clone));else if(a&&86==b.which){if(console.log(nodes_to_clone),
null!==nodes_to_clone){console.log("Paste");cy.$(":selected").unselect();for(b=0;b<nodes_to_clone.length;b++){var c={x:nodes_to_clone[b].position.x+10,y:nodes_to_clone[b].position.y+=10};nodes_to_clone[b].data.name=parseInt(cy.nodes().size()+1);nodes_to_clone[b].classes=nodes_to_clone[b].classes.replace("start","");delete nodes_to_clone[b].data.id;cy.add({data:nodes_to_clone[b].data,classes:nodes_to_clone[b].classes,group:nodes_to_clone[b].group,position:c}).select()}nodes_to_clone=cy.$(":selected").nodes().jsons()}}else if(27==
b.which)console.log("Press escape!"),defaultState(),cy.$(":selected").unselect();else if(49<=b.which&&58>=b.which)0==$(".dropdown-content.active").length?49==b.which?$(".pagemode").trigger("click"):50==b.which?$(".controlmode").trigger("click"):51==b.which?$(".jumpmode").trigger("click"):52==b.which?$(".connectionmode").trigger("click"):53==b.which&&$(".prebuilt").trigger("click"):$(".dropdown-content.active li a").eq(b.which-49).trigger("click");else if(0!=cy.$(":selected").length)if(8==b.which||
46==b.which)console.log("Press delete"),$(".deletebutton")[0].click();else if(13==b.which||32==b.which)event.preventDefault(),$(".openoverlay").each(function(a){"none"!=$(this).css("display")&&(console.log("Enter press on ",$(this)),$(this).trigger("click"))})})});var jumpOverlay={};
function populateJumpOverlay(a){a=a.data("triggerType");"attribute"==a?loadJumpConditions():"button"==a&&loadJumpButton();setJumpNodeType(a);$('#choosejumprepeat input[value="'+cy.$(":selected")[0].data("repeat")+'"]').prop("checked",!0);$("#choosejumptrigger :checked").prop("checked","")}
function saveJump(){cy.$(":selected")[0].data("repeat",$("#choosejumprepeat :checked").attr("value"));cy.$(":selected")[0].data("triggerType",$("#choosejumptrigger :checked").attr("value"));saveJumpConditions();saveJumpButton();setJumpNodeType(null);$("#jumpConditionList").html("");$("#jumpButtonList").html("")}
function setJumpNodeType(a){null===a?($("#choosejumptrigger :checked").prop("checked",""),$(".attribute, .button").hide()):"attribute"==a?($('#choosejumptrigger input[value="attribute"]').prop("checked",!0),$(".button").hide(),$(".attribute").show()):"button"==a&&($('#choosejumptrigger input[value="button"]').prop("checked",!0),$(".button").show(),$(".attribute").hide())}
function loadJumpConditions(){for(var a=cy.$(":selected")[0].data("conditions"),b=0;b<a.length;b++)$("#jumpConditionList").append(a[b]),$("#row_"+b+"_attbutton1_specValue_inputField").val($("#row_"+b+"_attbutton1_specValue").attr("value")),$("#row_"+b+"_attbutton2_specValue_inputField").val($("#row_"+b+"_attbutton2_specValue").attr("value")),$("#row_"+b+"_attButton1").tooltip({delay:50}),$("#row_"+b+"_attButton2").tooltip({delay:50})}
function saveJumpConditions(){for(var a=[],b=$("#jumpConditionList li"),c=0;c<b.size();c++)$("#row_"+c+"_attbutton1_specValue").attr("value",$("#row_"+c+"_attbutton1_specValue_inputField").val()),$("#row_"+c+"_attbutton2_specValue").attr("value",$("#row_"+c+"_attbutton2_specValue_inputField").val()),a.push(b[c].outerHTML);cy.$(":selected")[0].data("conditions",a)}
function addJumpCondition(){var a=parseInt($("#jumpConditionList li").size());generic_addRow("row_"+a+"_","jump-settings-menu","jumpConditionList")}function loadJumpButton(){cy.$(":selected")[0].data("button")}function saveJumpButton(){}function createNewJumpButton(){}function chooseJumpButton(){selected_page_template=project_project.project_templates[sel];$(".pagemode").html("Page Node ("+sel+")")}$("#choosejumptrigger").on("change",function(a){a=$("#choosejumptrigger :checked").attr("value");setJumpNodeType(a)});
$.contextMenu({selector:".jump-settings-menu",trigger:"left",build:function(a){return{items:{"Remove Condition":{name:"Remove Condition",callback:function(a,c){console.log("Element is ~~~~~~~~~~~",c.$trigger.closest("li"));c.$trigger.closest("li").remove()}}}}}});
function Logger(){this.data=[];this.player=[];this.flush=function(){this.data=[];this.player=[]};this.log=function(a){this.data.push(a)};this.makerOutput=function(){return this.data};this.outputAsArray=function(){return this.data};this.playerLog=function(a){this.player.push(a)};this.outputPlayerAsArray=function(){return this.player};this.playerOutput=function(){var a="";for(idx in this.player)a+=this.player[idx]+"</br>";return a}}var logger=new Logger,playConditions={};
function executeOutcomes(a){logger.log("<br>Executing Outcomes<br>");outcomes=a.json().data.outcomes;if(0<outcomes.length)for(a=0;a<outcomes.length;a++){var b=$.parseHTML(outcomes[a].html);console.log(b);var c=b[0].attributes[1].value;if("Attribute Modification"===c){var c=getAttributeValue(b[0].childNodes[1].childNodes[0]),d=b[0].childNodes[2].childNodes[0].data,e=getAttributeValue(b[0].childNodes[3].childNodes[0]),f=assessModification(c,d,e),g=gameAttributes_find(b[0].childNodes[1].childNodes[0].attributes.path.value);
f>g.maxValue?(logger.log("Arrtibute "+getAttributeText(b[0].childNodes[1].childNodes[0])+" has reached its maximum value.<br>"),g.value=g.maxValue):f<g.minValue?(logger.log("Arrtibute "+getAttributeText(b[0].childNodes[1].childNodes[0])+" has reached its minimum value.<br>"),g.value=g.minValue):g.value=f;logger.log("Outcome: "+getAttributeText(b[0].childNodes[1].childNodes[0])+"("+c+") "+d+" "+getAttributeText(b[0].childNodes[3].childNodes[0])+"("+e+") <br>");logger.log("Attribute "+getAttributeText(b[0].childNodes[1].childNodes[0])+
" was modified to "+g.value+"<br>")}else"Text-Attribute-Text"===c?(console.log("TEXT ATT TEXT:"),console.log("ONE: "+getTextButtonValue(b[0].childNodes[1].childNodes[0])),console.log("TWO: "+getTextButtonValue(b[0].childNodes[3].childNodes[0])),d=getTextButtonValue(b[0].childNodes[1].childNodes[0]),c=getAttributeValue(b[0].childNodes[2].childNodes[0]),b=getTextButtonValue(b[0].childNodes[3].childNodes[0]),logger.playerLog(d+c+b)):"Text"===c&&(d=getTextButtonValue(b[0].childNodes[1].childNodes[0]),
logger.playerLog(d))}else logger.log("Edge "+a.json().data.name+" has no outcomes.<br>")}function getTextButtonValue(a){return a.attributes["data-tooltip"].value}
function parseControl(a,b){for(var c=a.json().data.priorityList,d="",e=0;e<c.length;e++)d+=cy.edges("[id='"+c[e]+"']").json().data.name,e!==c.length-1&&(d+=",");logger.log("At control node. possible edges are: "+d+"<br>");d=-1;for(e=0;e<c.length;e++)!0===assessEdge(c[e])?(-1===d&&(d=e),logger.log("edge "+cy.edges("[id='"+c[e]+"']").json().data.name+" is a valid path. <br>")):logger.log("edge "+cy.edges("[id='"+c[e]+"']").json().data.name+" is an invalid path. <br>");e=null;-1!==d&&(e=c[d]);c=null;
null!==e?c=getIndexFromOutgoingEdges(e,b):(c=getIndexFromOutgoingEdges(a.json().data.defaultFailEdge,b),logger.log("All edges from control node "+a.json().data.name+" have evaluated false. Following default fail edge...<br>"));logger.log("Progressing through edge "+cy.edges("[id='"+e+"']").json().data.name+"<br>");-1!==c?progressStory(c):(progressStory(0),console.log("parseControl(): invalid edge id. progressing to first edge in outgoingEdges"))}
function getIndexFromOutgoingEdges(a,b){for(var c=b.jsons(),d=0;d<c.length;d++)if(c[d].data.id===a)return d;return-1}
function assessEdge(a){var b=cy.edges("[id='"+a+"']");logger.log("Assessing edge "+b.json().data.name+"<br>");if(void 0!==b){a=b.json().data.conditions;if(0<a.length){for(var b=!0,c=0;c<a.length;c++){var d=assessCondition(a[c]);console.log("RESULT: "+d);!1===d&&(b=!1)}return b}logger.log("Edge "+b.json().data.name+" has no conditions.<br>");return!0}console.log("assessEdge(): invalid edge. unable to assess");return!1}function boolToString(a){return a?"true":"false"}
function assessCondition(a){a=$.parseHTML(a.html);var b=a[0].attributes[1].value;if("1"===b){var b=getAttributeValue(a[0].childNodes[1].childNodes[0]),c=a[0].childNodes[2].childNodes[0].data,d=getAttributeValue(a[0].childNodes[3].childNodes[0]),e=assessComparison(b,c,d);logger.log("Condition: "+getAttributeText(a[0].childNodes[1].childNodes[0])+"("+b+") "+c+" "+getAttributeText(a[0].childNodes[3].childNodes[0])+"("+d+") is "+boolToString(e)+"<br>");return e}if("2"===b){var b=getAttributeValue(a[0].childNodes[1].childNodes[0]),
f=a[0].childNodes[2].childNodes[0].data,d=getAttributeValue(a[0].childNodes[3].childNodes[0]),e=assessModification(b,f,d),c=a[0].childNodes[4].childNodes[0].data,g=getAttributeValue(a[0].childNodes[5].childNodes[0]),e=assessComparison(e,c,g);logger.log("Condition: "+getAttributeText(a[0].childNodes[1].childNodes[0])+"("+b+") "+f+" "+getAttributeText(a[0].childNodes[3].childNodes[0])+"("+d+") "+c+" "+getAttributeText(a[0].childNodes[5].childNodes[0])+"("+g+") is "+boolToString(e)+"<br>");return e}if("3"===
b){var b=getAttributeValue(a[0].childNodes[1].childNodes[0]),f=a[0].childNodes[2].childNodes[0].data,d=getAttributeValue(a[0].childNodes[3].childNodes[0]),e=assessModification(b,f,d),c=a[0].childNodes[4].childNodes[0].data,h=getAttributeValue(a[0].childNodes[5].childNodes[0]),l=a[0].childNodes[6].childNodes[0].data,k=getAttributeValue(a[0].childNodes[7].childNodes[0]),g=assessModification(h,l,k),e=assessComparison(e,c,g);logger.log("Condition: "+getAttributeText(a[0].childNodes[1].childNodes[0])+
"("+b+") "+f+" "+getAttributeText(a[0].childNodes[3].childNodes[0])+"("+d+") "+c+" "+getAttributeText(a[0].childNodes[5].childNodes[0])+"("+h+")"+l+" "+getAttributeText(a[0].childNodes[7].childNodes[0])+"("+k+") is "+boolToString(e)+"<br>");return e}if("4"===b||"5"===b)return!1}
function getAttributeValue(a){if("input-field"===a.classList[0])return parseFloat(a.attributes.value.value),parseFloat(a.attributes.value.value);if("random"===a.classList[0]){console.log("random number found");var b=parseFloat(a.attributes.min.value);a=parseFloat(a.attributes.max.value);var c=Math.floor(Math.random()*(a-b+1))+b;console.log("Generated number between "+b+" and "+a+" is: "+c);return c}return gameAttributes_find(a.attributes.path.nodeValue).value}
function getAttributeText(a){if("input-field"===a.classList[0])return a.attributes.value.value;if("random"===a.classList[0])return"a random number";a=a.attributes.path.value.split("_");for(var b,c,d=0;d<a.length;d++)0===d?(c=a[d],b=gameAttributes_find(c).name):(c+="_"+a[d],b+=" : "+gameAttributes_find(c).name);return b}
function assessComparison(a,b,c){a=parseFloat(a);c=parseFloat(c);switch(b){case "=":return a===c?!0:!1;case "!=":return a!==c?!0:!1;case ">":return a>c?!0:!1;case "<":return a<c?!0:!1;case ">=":return a>=c?!0:!1;case "<=":return a<=c?!0:!1}}function assessModification(a,b,c){a=parseFloat(a);c=parseFloat(c);console.log("MODIFICATION: LEFT: "+a+" RIGHT: "+c);switch(b){case "=":return c;case "+":return a+c;case "-":return a-c;case "*":return a*c;case "/":return a/c}}var playJump={};
function initJumpNodes(){conditional_jump_nodes=cy.nodes('.jump[triggerType = "attribute"]');jump_context_stack=[]}function checkConditionalJumps(){var a=!1;jump_context_collection=cy.collection(jump_context_stack);conditional_jump_nodes.difference(jump_context_collection).forEach(function(b){if(evaluateConditionalJump(b))return a=b,!1});return a}
function evaluateConditionalJump(a){var b=a.json().data.conditions;if(0<b.length){a=!0;for(var c=0;c<b.length;c++)!1===assessJumpCondition(b[c])&&(a=!1);return a}console.log("Jump node"+a.data("name")+" has no conditions");return!0}
function assessJumpCondition(a){var b=$.parseHTML(a);a=getAttributeValue(b[0].childNodes[0].childNodes[0].childNodes[0]);var c=b[0].childNodes[0].childNodes[1].childNodes[0].data,b=getAttributeValue(b[0].childNodes[0].childNodes[2].childNodes[0]),d=assessComparison(a,c,b);console.log(a,c,b,"is: ",d);return d}
function runJumpNode(a){jump_context_stack.push(a);console.log("The jump node "+a.data("name")+" is now officially jumped to");a=a.outgoers()[0].target();console.log("Target node is",a);return a}function runJumpEnd(){var a=jump_context_stack.pop(),b=a.data("origin");"once"==a.data("repeat")&&jump_context_stack.unshift(a);console.log("Reached jump end. Now Jump back to",b.data("name"));return b}var playGame={};
function loadingScreen(a){a?($("#loader").show(),$(".progressbutton").hide()):($("#loader").hide(),$(".progressbutton").show())}
function prepareForGame(){loadingScreen(project_project.audio.changed);event_manager=new eventManager;outgoingEdges=currentNode=null;initJumpNodes();$(".playpage").html("");for(var a=cy.elements(".page"),b=0;b<a.length;b++)updatePageStyle(a[b]);if(project_project.audio.changed){$("#playwindow #audioplayerlist").html("");a=project_project.audio.getAsset();for(b=0;b<a.length;b++)a[b].loadAudio();project_project.audio.changed=!1}}
function wipeGame(){project_project.audio.loaded=0;cy.$(".jump").each(function(a,c){c.data("origin",null)});jump_context_stack=[];for(var a=0;a<project_project.audio.getAsset().length;a++)project_project.audio.assets[a].setVolume(100),project_project.audio.assets[a].stopAudio();$(".playpage").html("");$(".playpage").attr("style","");event_manager.clearTimer()}
function parseNode(){console.log("Parse node ",currentNode.data("name"));outgoingEdges=currentNode.outgoers().edges();currentNode.hasClass("page")?parsePage(outgoingEdges):currentNode.hasClass("control")?parseControl(currentNode,outgoingEdges):currentNode.hasClass("jumpend")&&(console.log("Parse a jump end node"),currentNode=runJumpEnd(currentNode),parseNode())}function parsePage(a){event_manager.clearTimer();event_manager.newPage(currentNode.data("events"));stylePage()}
function stylePage(){$(".playpage").html("");$(".playpage").attr("style",currentNode.data("pagestyle"));resizePlayPage();var a=currentNode.data("textcontainers"),b=currentNode.data("decisioncontainers"),c=currentNode.data("imgcontainers"),d=currentNode.data("vidcontainers"),e=currentNode.data("outputcontainer");currentNode.data("events");for(var f=0;f<a.length;f++)$(".playpage").append(a[f].html);for(f=0;f<c.length;f++)$(".playpage").append(c[f].html);for(f=0;f<d.length;f++)$(".playpage").append(d[f].html);
for(f=0;f<b.length;f++)assessEdge(currentNode.outgoers("[name='"+b[f].name+"']").id())&&$(".playpage").append(b[f].html);$(".playpage").append(e);$(".output-container").hasClass("player")?$(".output-container").children().append(logger.playerOutput()):$(".output-container").hasClass("maker")&&$(".output-container").children().append(logger.makerOutput());$(".playpage").children("div[class^='decision-container']").each(function(a){$(this).click(function(){progressStory(a)})});$(".playpage .handlecontainer").hide();
$(".playpage").children().removeClass("resize-element");$(".playpage").children().removeClass("resize-child");$(".playpage").children().children().removeClass("resize-element");$(".playpage").children().attr("contenteditable","false");$(".playpage").children().children().attr("contenteditable","false")}
function progressStory(a){if(null===currentNode)1>cy.$("*").length?alert("The project is empty"):($(".progressbutton").hide(),currentNode=cy.$(".start")[0],parseNode());else if(0<currentNode.outgoers().size()){currentNode=outgoingEdges.eq(a).target();executeOutcomes(outgoingEdges.eq(a));console.log("Now on node ",currentNode.data("id"));if(a=checkConditionalJumps())a.data("origin",currentNode),currentNode=runJumpNode(a),console.log("We jumped!");parseNode()}else currentNode=null,console.log("Reached the end"),
$(".playpage").html("<h1>Fin!</h1>"),wipeGame();logger.flush()}function stripDraggable(a){return a.replace(/drag-element/g,"")}
function resizePlayPage(){$(".playpage").width(project_project.resolution.x);$(".playpage").height(project_project.resolution.y);var a;a=$(window).height();var b=$(".nav-wrapper").outerHeight()+$(".progressbutton:visible").outerHeight()+$(".gobackbutton:visible").outerHeight()+1;$("#playwindow").css("height",a-b);a=$("#playwindow").width();var b=$("#playwindow").height(),c=$(".playpage").width(),d=$(".playpage").outerHeight();a=Math.min(a/c,b/d);$(".playpage").css({transform:"scale("+a+")"});$(".playpage").css({"-ms-transform":"scale("+
a+")"});$(".playpage").css({"-webkit-transform":"scale("+a+")"})}$(window).resize(resizePlayPage);console.log("Enter main.js version 0.5.0");$(document).ready();$("select").material_select();$(".button-collapse").sideNav();http_validateToken();var testgraph={};function runPlayGameTests(){var a=checkValidGraph();""==a?createModule_playGame():(a.push("Continue Anyway?"),myModal.prompt("Graph Tests Failed",a,[],function(a){createModule_playGame()}))}
function runTests(){var a=checkValidGraph();if(0==a.length)Materialize.toast("All tests passed",3E3,"rounded");else for(var b=0;b<a.length;b++)Materialize.toast(a[b],3E3,"rounded")}
function checkValidGraph(){var a=[];1>cy.$("*").length&&a.push("The graph is empty");cy.$(".start").hasClass("page")||a.push("Starting class must be a page node\n");testConnectivity()||a.push("Graph is NOT connected\n");testJumpNodes()||a.push("Jump End nodes can be reached without arriving from a jump start!\n");return a}
function testConnectivity(){var a=cy.$(".start, .jump"),b=cy.$(".page, .control, .jumpend");console.log("Root nodes: "+a);var c=cy.collection(),c=c.add(a);b.union(cy.$("edge")).dfs({roots:a,visit:function(a,b,d){c=c.add(d);console.log("visit "+this.id()+" total "+a)},directed:!0});console.log("Total nodes:"+b.size()+" Connected_nodes: "+c.size());var d=b.diff(c).left;console.log("Disconnected:",d.size());console.log("left: "+d.map(function(a){return a.id()}).join(", "));d.addClass("disconnected");
setTimeout(function(){d.removeClass("disconnected")},3E3);return 0==d.size()}function testJumpNodes(){var a=!0;cy.$(".jumpend").each(function(b,c){var d=c.predecessors("node").roots();for(b=0;b<d.size();b++)d[b].hasClass("jump")||(console.log("bad one found",d[b].data("name")),a=!1,d[b].flashClass("jumpenderror",3E3),c.flashClass("jumpenderror",3E3))});return a}var tests={};
function testAudioObjects(){console.info("Testing Audio");project_project.audio.addAsset("Reggae Rap","https://www.youtube.com/watch?v=4vKmEmY8ZD8");project_project.audio.addAsset("Fantasy RPG","https://www.youtube.com/watch?v=Pq824AM9ZHQ");project_project.audio.addAsset("Missing You","https://www.youtube.com/watch?v=Ct_t92NloA8");project_project.audio.addAsset("Electronic","https://www.youtube.com/watch?v=MiRcFl8iafg");project_project.audio.selected_audio=1;project_project.audio.removeAsset();project_project.audio.addAsset("Fantasy RPG",
"https://www.youtube.com/watch?v=Pq824AM9ZHQ");try{for(var a=0;a<project_project.audio.assets.length;a++)if(void 0===project_project.audio.assets[a])throw"There is an undefined entry in the array";console.info("Testing Passed")}catch(b){console.log("Audio error encountered: "+b)}};var play_httpRequests={};function load(a,b){addTokenToHeader();return $.ajax({url:"/getProject",data:{projectOwner:a,projectName:b},cache:!1,type:"GET",success:function(c){"INVALID"===c?(console.log('No project found called "'+b+'" made by "'+a+'"'),$("#data").text('No project found called "'+b+'" made by "'+a+'"')):"EXPIRED"===c?(console.log("token expired"),$("#data").text("token expired")):(delete c[0]._id,console.log(c),project_project=c[0])},contenttype:"application/json"})}
function authenticate(a){window.localStorage.setItem("play-token","");return $.ajax({url:"/playAuth",data:{uname:"guest"},cache:!1,type:"POST",success:function(a){console.log("LOGIN RES:");console.log(a);window.localStorage.setItem("play-token",JSON.stringify(a))},contenttype:"application/json"})}function addTokenToHeader(){var a=window.localStorage.getItem("play-token");a&&(a=JSON.parse(a).token,$.ajaxSetup({headers:{"x-access-token":a}}))};var show={};$(document).ready();console.log($.cookie("FM_playUsername"));console.log($.cookie("FM_playProject"));$.when(getProject()).done(function(){prepareForGame();$("#loader").hide();$(".progressbutton").show()});function getProject(){var a=$.cookie("FM_playUsername"),b=$.cookie("FM_playProject");$.when(authenticate()).done(function(){$.when(load(a,b)).done(function(){http_setupCy()})})};
