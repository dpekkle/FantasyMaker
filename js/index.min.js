var users={};function users_generateNewUser(){return{username:"none",password:"none"}}function users_getUsername(){return window.localStorage.getItem("token")?JSON.parse(window.localStorage.getItem("token")).user:"INVALID"}function users_setToken(a){$.when(window.localStorage.setItem("token",JSON.stringify(a))).done()}function users_flushToken(){window.localStorage.setItem("token","")}
function users_getToken(){return window.localStorage.getItem("token")?JSON.parse(window.localStorage.getItem("token")):"INVALID"};var navigation={},nav_isProject=!1;function nav_toLogin(){nav_isProject=!1;window.location.href=host_index()}function nav_toProjects(){nav_hideLogin();nav_hideMain();nav_navBarLoggedIn();nav_showProjects()}function nav_toMain(){nav_hideLogin();nav_hideProjects();nav_showMain()}function nav_hideLogin(){$("#requestLogin").hide()}function nav_hideProjects(){$("#projects").hide()}function nav_hideMain(){$("#mainContent").hide()}function nav_showLogin(){$("#requestLogin").show()}
function nav_showProjects(){!0===nav_isProject?(console.log("isProject"),$("#currentProject").hasClass("hide")&&$("#currentProject").removeClass("hide"),$("#currentProject").show()):console.log("noProject");$("#projects").hasClass("hide")&&$("#projects").removeClass("hide");$("#projects").show()}function nav_showMain(){$("#mainContent").hasClass("hide")&&$("#mainContent").removeClass("hide");$("#mainContent").show();resizeCanvas()}
function nav_navBarLoggedIn(){$(".profile_button").text(users_getUsername());$(".login_button").hide();$(".signup_button").hide();$(".project_button").hasClass("hide")&&$(".project_button").removeClass("hide");$(".project_button").show();$(".profile_button").hasClass("hide")&&$(".profile_button").removeClass("hide");$(".profile_button").show()}
function nav_navBarLoggedOut(){$(".profile_button").text("");$(".project_button").hide();$(".profile_button").hide();$(".login_button").show();$(".signup_button").show()};var http_loginSignup={};function http_signUp(a,b){return $.ajax({url:"/signUp",data:{data:a},cache:!1,type:"POST",success:function(a){http_handleAuth(a)},contenttype:"application/json"})}function http_login(a,b,d){return $.ajax({url:"/login",data:{uname:a,pwd:b},cache:!1,type:"POST",success:function(a){d.data=a},contenttype:"application/json"})}
function http_handleAuth(a){return"EXPIRED"===a||"NO_TOKEN"===a||"AUTH_ERROR"===a?("EXPIRED"===a?console.log("http_handleAuth(): Token is expired"):"AUTH_ERROR"===a?console.log("http_handleAuth(): auth error"):console.log("http_handleAuth(): No Token"),users_flushToken(),nav_toLogin(),!1):!0}
function http_validateToken(a){http_addTokenToHeader();return $.ajax({url:"/validateToken",cache:!1,type:"GET",success:function(b){"EXPIRED"===b||"NO_TOKEN"===b||"AUTH_ERROR"===b?("EXPIRED"===b?console.log("http_handleAuth(): Token is expired"):"AUTH_ERROR"===b?console.log("http_handleAuth(): auth error"):console.log("http_handleAuth(): No Token"),a.result=!1,users_flushToken(),window.location.href.includes(host_index())||nav_toLogin()):(console.log("USER IS ALREADY LOGGED IN"),a.result=!0,window.location.href.includes(host_create())&&
($("#profile_button").text(users_getUsername()),projectSettings_prepThenNavToProjects(project_project)))},contenttype:"application/json"})}function http_addTokenToHeader(){var a=window.localStorage.getItem("token");a&&(a=JSON.parse(a).token,$.ajaxSetup({headers:{"x-access-token":a}}))};var host={},host_location="http://localhost:3000/";function host_create(){return host_location+"create.html"}function host_browse(){return host_location+"browse.html"}function host_play(){return host_location+"play/"}function host_index(){return host_location+"index.html"};var prompts={};
function myModal(){this.confirm=!1;this.validated=!0;this.callbackFunction=this.verifyFunction=null;this.init=function(){$("body").append('<div id="prompt-modal" class=" modal"><div class="modal-content"></div><div class="modal-footer"><a href="#!" class=" modal-action modal-close waves-effect waves-red btn-flat onclick="myModal.evaluateModal(false)">Cancel</a><a href="#!" class=" modal-action waves-effect waves-green btn-flat" onclick="myModal.evaluateModal(true)">Confirm</a></div></div>')};this.evaluateModal=
function(a){console.log("Button pressed");this.confirm=a;var b=[];if(this.confirm)if($("#prompt-modal .modal-content").children(".input-field").each(function(a){a=$(this).children("input");"number"==a.attr("type")?(console.log("We got a number entry"),b.push(parseFloat(a.val()))):b.push(a.val())}),null!==this.verifyFunction){console.log("Results: ");for(a=0;a<b.length;a++)console.log(b[a]);a=this.verifyFunction(b);!0===a?(this.callbackFunction(b),$("#prompt-modal").closeModal()):void 0!==a&&this.warning(a)}else this.callbackFunction(b),
$("#prompt-modal").closeModal();else $("#prompt-modal").closeModal()};this.prompt=function(a,b,d,c,f){var e=$("#prompt-modal .modal-content");this.verifyFunction=void 0!==f?f:null;this.callbackFunction=c;e.html("");a=""+('<h3 style="text-align:center;">'+a+"</h3>");if(Array.isArray(b))for(a+='<p id="promptDesc">'+b[0]+"</p>",c=1;c<b.length;c++)a+="<p>"+b[c]+"</p>";else a+='<p id="promptDesc">'+b+"</p>";if(d)for(c=0;c<d.length;c++)"number"==d[c].type?(a+='<div class="input-field">',a+='<label for="'+
c+'"> '+d[c].name+'</label><input id= "'+c+'"type="'+d[c].type+'" value = "'+parseFloat(d[c]["default"])+'" min ="'+d[c].min+'" max ="'+d[c].max+'">'):(a+='<div class="input-field">',a+='<label for="'+c+'"> '+d[c].name+'</label><input id= "'+c+'"type="'+d[c].type+'" value = "'+d[c]["default"]+'">'),a+="</div>";e.append(a);$("#prompt-modal .modal-content input").eq(0).prop("autofocus",!0);$("#prompt-modal").openModal({dismissible:!1,ready:function(){Materialize.updateTextFields()},complete:function(){this.confirm=
!1;this.validated=!0;this.callbackFunction=this.verifyFunction=null;e.html("")}})};this.warning=function(a){$("#promptDesc").css("color","red");!1!==a&&$("#promptDesc").text(a)}}myModal=new myModal;myModal.init();var loginSignup={},loginSignupState=!1;$(document).ready();window.location.href.includes(host_create()&&!window.location.href.includes(host_location+"/play"))||index_autoLogin();
function project_login(){myModal.prompt("Log In","Log in and continue creating!",[{name:"Username","default":"",type:"text"},{name:"Password","default":"",type:"password"}],function(a){},function(a){a[0]=a[0].trim();if(!1===/^[a-zA-Z0-9]+$/.test(a[0]))return myModal.warning("Usernames can only contain letters and numbers"),!1;var b={data:{}};$.when(http_login(a[0],a[1],b)).done(function(){"INVALID_USERNAME"!==b.data&&"INVALID_PASSWORD"!==b.data&&"SERVER_ERR"!==b.data?(project_successfulLogin(b),Materialize.toast("Welcome back "+
users_getUsername()+"!",3E3,"rounded")):myModal.warning("Login details were invalid. Please try again.")})})}function project_successfulLogin(a){window.localStorage.setItem("token",JSON.stringify(a.data));$("#prompt-modal").closeModal();console.log(users_getUsername()+" logged in");$("#profile_button").text(users_getUsername());window.location.href=host_create();projectSettings_prepThenNavToProjects(project_project)}
function project_signUp(){myModal.prompt("Sign Up","Become a game creator with FantasyMaker!",[{name:"Username","default":"",type:"email"},{name:"Password","default":"",type:"password"},{name:"Confirm Password","default":"",type:"password"}],function(a){},function(a){a[0]=a[0].trim();if(""===a[0]||""===a[1]||""===a[2])return myModal.warning("All fields must be filed out."),!1;if(a[1]!==a[2])return myModal.warning("Your password and confirmation password do not match."),!1;if(!1===/^[a-zA-Z0-9]+$/.test(a[0]))return myModal.warning("Usernames can only contain letters and numbers"),
!1;var b=users_generateNewUser();b.username=a[0];b.password=a[1];$.when(http_signUp(b,"")).done(function(d){if("VALID"===d){Materialize.toast("Welcome to FantasyMaker "+a[0]+".",3E3,"rounded");$("#prompt-modal").closeModal();var c={data:{}};$.when(http_login(b.username,b.password,c)).done(function(){"INVALID_USERNAME"!==c.data&&"INVALID_PASSWORD"!==c.data&&"SERVER_ERR"!==c.data?project_successfulLogin(c):myModal.warning("Login details were invalid. Please try again.")})}else myModal.warning("That username has already been taken. Please try another username")})})}
function createLinkClicked(){!0===loginSignupState?window.location.href=host_create():!1===loginSignupState&&project_login()}function index_autoLogin(){var a={};$.when(http_validateToken(a)).done(function(){console.log(a.result);loginSignupState=a.result;index_loginSignup_setupState(loginSignupState)})}
function index_loginSignup_setupState(a){!0===a?($(".login_button").hide(),$(".signup_button").hide(),$(".project_button").show(),$(".profile_button").text(users_getUsername()),$(".profile_button").show()):!1===a&&($(".login_button").show(),$(".signup_button").show(),$(".project_button").hide(),$(".profile_button").hide())}
function project_logOut(){myModal.prompt("Log Out","Are you sure you wish to log out? Any unsaved progress will be lost.",[],function(a){console.log(users_getUsername()+" logged out");loginSignupState=!1;index_loginSignup_setupState(loginSignupState);users_flushToken();nav_toLogin()},function(a){return!0})};
